<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>5.7 Nonparametric measures and tests for two dependent samples | index.knit</title>
  <meta name="description" content="MTH2006 Topic 5<br />
Nonparametric statistics</div>" />
  <meta name="generator" content="bookdown 0.29 and GitBook 2.6.7" />

  <meta property="og:title" content="5.7 Nonparametric measures and tests for two dependent samples | index.knit" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="5.7 Nonparametric measures and tests for two dependent samples | index.knit" />
  
  
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="permrand.html"/>
<link rel="next" href="summary.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="5" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>5</b> Nonparametric statistics</a>
<ul>
<li class="chapter" data-level="5.1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>5.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="introduction.html"><a href="introduction.html#topic-webpage"><i class="fa fa-check"></i><b>5.1.1</b> Topic webpage</a></li>
<li class="chapter" data-level="5.1.2" data-path="introduction.html"><a href="introduction.html#proposed-learning-schedule"><i class="fa fa-check"></i><b>5.1.2</b> Proposed learning schedule</a></li>
<li class="chapter" data-level="5.1.3" data-path="introduction.html"><a href="introduction.html#office-hour"><i class="fa fa-check"></i><b>5.1.3</b> Office hour</a></li>
<li class="chapter" data-level="5.1.4" data-path="introduction.html"><a href="introduction.html#resources"><i class="fa fa-check"></i><b>5.1.4</b> Resources</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="pcdf.html"><a href="pcdf.html"><i class="fa fa-check"></i><b>5.2</b> Estimating cdfs and pdfs</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="pcdf.html"><a href="pcdf.html#teignmouth-rainfall"><i class="fa fa-check"></i><b>5.2.1</b> Teignmouth rainfall </a></li>
<li class="chapter" data-level="5.2.2" data-path="pcdf.html"><a href="pcdf.html#para"><i class="fa fa-check"></i><b>5.2.2</b> Parametric pdf estimation</a></li>
<li class="chapter" data-level="5.2.3" data-path="pcdf.html"><a href="pcdf.html#ord"><i class="fa fa-check"></i><b>5.2.3</b> Order statistics and ranks</a></li>
<li class="chapter" data-level="5.2.4" data-path="pcdf.html"><a href="pcdf.html#empirical-cdf-estimation"><i class="fa fa-check"></i><b>5.2.4</b> Empirical cdf estimation</a></li>
<li class="chapter" data-level="5.2.5" data-path="pcdf.html"><a href="pcdf.html#hist"><i class="fa fa-check"></i><b>5.2.5</b> Histograms</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="gof.html"><a href="gof.html"><i class="fa fa-check"></i><b>5.3</b> Goodness of fit</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="gof.html"><a href="gof.html#quantilequantile-plots"><i class="fa fa-check"></i><b>5.3.1</b> Quantile–quantile plots</a></li>
<li class="chapter" data-level="5.3.2" data-path="gof.html"><a href="gof.html#pearsons-chi-squared-test"><i class="fa fa-check"></i><b>5.3.2</b> Pearson’s chi-squared test</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="kde.html"><a href="kde.html"><i class="fa fa-check"></i><b>5.4</b> Kernel density estimation</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="kde.html"><a href="kde.html#old-faithful-geyser-eruption-times"><i class="fa fa-check"></i><b>5.4.1</b> Old Faithful geyser eruption times</a></li>
<li class="chapter" data-level="5.4.2" data-path="kde.html"><a href="kde.html#kdedef"><i class="fa fa-check"></i><b>5.4.2</b> Definition</a></li>
<li class="chapter" data-level="5.4.3" data-path="kde.html"><a href="kde.html#kernel-functions"><i class="fa fa-check"></i><b>5.4.3</b> Kernel functions</a></li>
<li class="chapter" data-level="5.4.4" data-path="kde.html"><a href="kde.html#kernel-bandwidth"><i class="fa fa-check"></i><b>5.4.4</b> Kernel bandwidth</a></li>
<li class="chapter" data-level="5.4.5" data-path="kde.html"><a href="kde.html#kernel-density-estimation-in-r"><i class="fa fa-check"></i><b>5.4.5</b> Kernel density estimation in <code>R</code></a></li>
<li class="chapter" data-level="5.4.6" data-path="kde.html"><a href="kde.html#some-properties-of-hatf_hy"><i class="fa fa-check"></i><b>5.4.6</b> Some properties of <span class="math inline">\(\hat{f}_h(y)\)</span></a></li>
<li class="chapter" data-level="5.4.7" data-path="kde.html"><a href="kde.html#nkde"><i class="fa fa-check"></i><b>5.4.7</b> Optimal bandwidths by assuming normal <span class="math inline">\(f_Y(y)\)</span></a></li>
<li class="chapter" data-level="5.4.8" data-path="kde.html"><a href="kde.html#notnkde"><i class="fa fa-check"></i><b>5.4.8</b> Optimal bandwidths for any <span class="math inline">\(f_Y(y)\)</span> by cross-validation</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="indepsamp.html"><a href="indepsamp.html"><i class="fa fa-check"></i><b>5.5</b> Nonparametric tests for two independent samples</a>
<ul>
<li class="chapter" data-level="5.5.1" data-path="indepsamp.html"><a href="indepsamp.html#welchs-t-test"><i class="fa fa-check"></i><b>5.5.1</b> Welch’s <span class="math inline">\(t\)</span>-test</a></li>
<li class="chapter" data-level="5.5.2" data-path="indepsamp.html"><a href="indepsamp.html#kolmogorov-smirnov-test"><i class="fa fa-check"></i><b>5.5.2</b> Kolmogorov-Smirnov test</a></li>
<li class="chapter" data-level="5.5.3" data-path="indepsamp.html"><a href="indepsamp.html#mann-whitney-u-test"><i class="fa fa-check"></i><b>5.5.3</b> Mann-Whitney <span class="math inline">\(U\)</span> test</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="permrand.html"><a href="permrand.html"><i class="fa fa-check"></i><b>5.6</b> Permutation and randomisation tests</a>
<ul>
<li class="chapter" data-level="5.6.1" data-path="permrand.html"><a href="permrand.html#permutation"><i class="fa fa-check"></i><b>5.6.1</b> Permutation tests</a></li>
<li class="chapter" data-level="5.6.2" data-path="permrand.html"><a href="permrand.html#randomisation-tests"><i class="fa fa-check"></i><b>5.6.2</b> Randomisation tests</a></li>
<li class="chapter" data-level="5.6.3" data-path="permrand.html"><a href="permrand.html#exspear"><i class="fa fa-check"></i><b>5.6.3</b> Pearson’s correlation coefficient example</a></li>
</ul></li>
<li class="chapter" data-level="5.7" data-path="depsamp.html"><a href="depsamp.html"><i class="fa fa-check"></i><b>5.7</b> Nonparametric measures and tests for two dependent samples</a>
<ul>
<li class="chapter" data-level="5.7.1" data-path="depsamp.html"><a href="depsamp.html#spear"><i class="fa fa-check"></i><b>5.7.1</b> Spearman’s rank correlation coefficient</a></li>
<li class="chapter" data-level="5.7.2" data-path="depsamp.html"><a href="depsamp.html#wilcoxon-signed-rank-test"><i class="fa fa-check"></i><b>5.7.2</b> Wilcoxon signed rank test</a></li>
</ul></li>
<li class="chapter" data-level="5.8" data-path="summary.html"><a href="summary.html"><i class="fa fa-check"></i><b>5.8</b> Summary</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./"><div class="line-block">MTH2006 Topic 5<br />
Nonparametric statistics</div></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="depsamp" class="section level2 hasAnchor" number="5.7">
<h2><span class="header-section-number">5.7</span> Nonparametric measures and tests for two dependent samples<a href="depsamp.html#depsamp" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In Section <a href="indepsamp.html#indepsamp">5.5</a> we considered tests for comparing one sample against another when the samples could be considered independent of each other. Section <a href="permrand.html#permrand">5.6</a> then used a randomisation test to test for a linear relationship between one sample that we believed was related to another sample, as the samples were paired. This section will cover Spearman’s rank correlation coefficient, a nonparametric estimate of the correlation between two samples, and then the Wilcoxon signed rank test, which tests for a difference between samples of pairs.</p>
<div id="spear" class="section level3 hasAnchor" number="5.7.1">
<h3><span class="header-section-number">5.7.1</span> Spearman’s rank correlation coefficient<a href="depsamp.html#spear" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Spearman’s rank correlation coefficient is a fairly simple modification to Pearson’s correlation coefficient that can better capture non-linear relationships, given that Pearson’s correlation coefficient quantifies linearity. Put simply Spearman’s rank correlation coefficient is Pearson’s correlation coefficient applied to ranks. It takes the value <span class="math inline">\(\pm 1\)</span> if a relationship is <em>monotonic</em>, whereas Pearson’s correlation coefficient takes <span class="math inline">\(\pm 1\)</span> when a relationship is linear, i.e. a specific type of monotonic relationship.</p>
<p>Recall the sample of pairs <span class="math inline">\((x_1, y_1), \ldots, (x_n, y_n)\)</span>. Let <span class="math inline">\((r_{x, 1}, r_{y, 1}), \ldots, (r_{x, n}, r_{y, n})\)</span> denote their corresponding ranks, so that <span class="math inline">\(r_{x, 1}\)</span> is the rank of <span class="math inline">\(x_1\)</span> amongst <span class="math inline">\(x_1, \ldots, x_n\)</span>, with the remaining <span class="math inline">\(r_{x, i}\)</span>s and <span class="math inline">\(r_{y, i}\)</span>s defined similarly. Spearman’s rank correlation coefficient is then calculated for the sample as <span class="math display">\[\hat \rho_{s, xy} = \dfrac{\sum_{i=1}^n (r_{x,i} - \overline r_x)(r_{y,i} - \overline r_y)}{\sqrt{[\sum_{i = 1}^n(r_{x, i} - \overline r_x)^2][\sum_{i = 1}^n(r_{y,i} - \overline r_y)^2]}},\]</span> where <span class="math inline">\(\overline r_x = (r_{x, 1} + \ldots + r_{x, n})/n\)</span> and <span class="math inline">\(\overline r_y = (r_{y, 1} + \ldots + r_{y, n})/n\)</span>.</p>
<p>Now consider the following data, which are plotted on the left-hand side of Figure <a href="depsamp.html#fig:spear">5.22</a>.</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="depsamp.html#cb75-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.5</span>, <span class="sc">-</span><span class="fl">0.4</span>, <span class="sc">-</span><span class="fl">0.3</span>, <span class="sc">-</span><span class="fl">0.2</span>, <span class="sc">-</span><span class="fl">0.1</span>, <span class="dv">0</span>, <span class="fl">0.1</span>, <span class="fl">0.2</span>, <span class="fl">0.3</span>, <span class="fl">0.4</span>, <span class="fl">0.5</span>)</span>
<span id="cb75-2"><a href="depsamp.html#cb75-2" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.5</span>, <span class="sc">-</span><span class="fl">0.256</span>, <span class="sc">-</span><span class="fl">0.108</span>, <span class="sc">-</span><span class="fl">0.032</span>, <span class="sc">-</span><span class="fl">0.004</span>, <span class="dv">0</span>, <span class="fl">0.004</span>, <span class="fl">0.032</span>, <span class="fl">0.108</span>, <span class="fl">0.256</span>, <span class="fl">0.5</span>)</span></code></pre></div>
<p>The sample Pearson’s correlation coefficient is 0.9216, whereas the sample Spearman’s rank correlation coefficient is 1. In Section <a href="permrand.html#permrand">5.6</a> we considered the null hypothesis that two variables were unrelated versus the alternative that they were related. Figure <a href="depsamp.html#fig:spear">5.22</a> shows that <code>x</code> and <code>y</code> are perfectly related, but that their relationship is not linear. Hence as a test statistic, Pearson’s correlation coefficient is flawed as a general measure of whether variables are related since its extreme values occur only when variables are <em>linearly</em> related; when we are interested in whether variables are <em>monotonically</em> related, Spearman’s rank correlation coefficient can be more robust.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:spear"></span>
<img src="index_files/figure-html/spear-1.png" alt="Plots of `y` against `x` (left) and `rank(y)` against `rank(x)` for data in Section \@ref(spear)" width="528" />
<p class="caption">
Figure 5.22: Plots of <code>y</code> against <code>x</code> (left) and <code>rank(y)</code> against <code>rank(x)</code> for data in Section <a href="depsamp.html#spear">5.7.1</a>
</p>
</div>
<p>If we have samples <code>x</code> and <code>y</code> then we can calculate Spearman’s rank correlation coefficient in <code>R</code> using the <code>rank()</code> function with <code>cor(rank(x), rank(y))</code>. However, this is equivalent to <code>cor(x, y, method = "spearman")</code>, which should be preferred.</p>
<p>When a linear relationship is reasonable to capture how two variables are related, which appeared to be the case for MTH2006 heights and weights, then Spearman’s rank correlation coefficient usually still gives sensible values. For example, we should hope the Pearson’s and Spearman’s rank correlation coefficients are similar. The following <code>R</code> code shows us that this is the case for the MTH2006 heights and weights.</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="depsamp.html#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="fu">cor</span>(bio<span class="sc">$</span>Height, bio<span class="sc">$</span>Weight), <span class="fu">cor</span>(bio<span class="sc">$</span>Height, bio<span class="sc">$</span>Weight, <span class="at">method =</span> <span class="st">&quot;spearman&quot;</span>))</span></code></pre></div>
<pre><code>## [1] 0.6126704 0.6429311</code></pre>
</div>
<div id="wilcoxon-signed-rank-test" class="section level3 hasAnchor" number="5.7.2">
<h3><span class="header-section-number">5.7.2</span> Wilcoxon signed rank test<a href="depsamp.html#wilcoxon-signed-rank-test" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>For the Mann-Whitney <span class="math inline">\(U\)</span> test we considered <em>independent</em> samples. Now suppose that we have two samples that are <em>dependent</em> in such a away that they are <em>paired</em>. We may write such a random sample of pairs as <span class="math inline">\((X_1, Y_1), \ldots, (X_n, Y_n)\)</span>; thus we have a sample of <span class="math inline">\(n\)</span> pairs. Let <span class="math inline">\(D_i = Y_i - X_i\)</span> for <span class="math inline">\(i = 1, \ldots, n\)</span>, and let <span class="math inline">\(f_D(d)\)</span> denote its pdf. For the Wilcoxon signed rank test we assume that <span class="math inline">\(f_D(d - \mu)\)</span> is symmetric and then the hypotheses are <span class="math display">\[\begin{align*}
H_0&amp;: \mu = 0,\\
H_1&amp;: \mu \neq 0.
\end{align*}\]</span></p>
<p>The rationale for this test is that if <span class="math inline">\(X_i\)</span> and <span class="math inline">\(Y_i\)</span> are similar, we’d expect <span class="math inline">\(D_i\)</span> to be equally likely to be either side of zero. The distribution of the values of the differences is then assumed to be approximately symmetric, which is often a reasonable assumption in practice.</p>
<p>For the Wilcoxon signed rank we use the test statistic<a href="#fn11" class="footnote-ref" id="fnref11"><sup>11</sup></a></p>
<p><span class="math display" id="eq:wilc">\[\begin{equation}
T = \min\left\{\sum_{i = 1}^n I(X_i &gt; Y_i) R_i, \sum_{i = 1}^n I(X_i &lt; Y_i) R_i\right\},
\tag{5.12}
\end{equation}\]</span></p>
<p>where <span class="math inline">\(R_i\)</span> is the rank of <span class="math inline">\(|D_i|\)</span>. If our observed test statistic is ‘small’ relative to the sampling distribution of <span class="math inline">\(T\)</span> under <span class="math inline">\(H_0\)</span> then this casts doubt on <span class="math inline">\(H_0\)</span>. The sampling distribution of <span class="math inline">\(T\)</span> under <span class="math inline">\(H_0\)</span> doesn’t have closed form. Tables exist that give critical values of <span class="math inline">\(T\)</span> for small values of <span class="math inline">\(n\)</span> and specific quantiles, which allows the hypothesis test above to be performed for pre-defined significance levels. However, its cdf can be evaluated accurately in <code>R</code> with function <code>psignrank()</code>, which is what we’ll use in MTH2006.</p>
<p>If a two-sided alternative hypothesis <span class="math inline">\(H_1\)</span> is used, our <span class="math inline">\(p\)</span>-value is <span class="math inline">\(2\text{Pr}(T \leq t_\text{obs})\)</span> based on the sampling distribution of <span class="math inline">\(T\)</span> under <span class="math inline">\(H_0\)</span>. One-sided alternative hypotheses can be used, where appropriate. Now write <span class="math inline">\(T\)</span> in equation <a href="depsamp.html#eq:wilc">(5.12)</a> as <span class="math inline">\(\min\{T_X, T_Y\}\)</span>, where <span class="math inline">\(T_X = \sum_{i = 1}^n I(X_i &gt; Y_i) R_i\)</span> and <span class="math inline">\(T_Y = \sum_{i = 1}^n I(X_i &lt; Y_i) R_i\)</span>. If <span class="math inline">\(H_1\)</span> is <span class="math inline">\(\mu &gt; 0\)</span>, then we reject <span class="math inline">\(H_0\)</span> if our observed value of <span class="math inline">\(T_X\)</span>, denoted <span class="math inline">\(t_{\text{obs}, X}\)</span>, is ‘small’. If <span class="math inline">\(H_1\)</span> is <span class="math inline">\(\mu &lt; 0\)</span>, then we reject <span class="math inline">\(H_0\)</span> if our observed value of <span class="math inline">\(T_Y\)</span>, <span class="math inline">\(t_{\text{obs}, Y}\)</span>, is ‘small’. On both occasions, ‘small’ is relative to the respective sampling distributions of <span class="math inline">\(T_X\)</span> and <span class="math inline">\(T_Y\)</span>.</p>
<p>If any ties occur in the <span class="math inline">\(X_i, Y_i\)</span> pairs, i.e. <span class="math inline">\(D_i = 0\)</span>, these are omitted from calculations of <span class="math inline">\(T\)</span> with <span class="math inline">\(n\)</span> replaced by <span class="math inline">\(\sum_{i = 1}^n I(D_i \neq 0)\)</span>.</p>
<p>In the case of `large’ <span class="math inline">\(n\)</span>, where we still take <span class="math inline">\(n \geq 20\)</span> as large, a normal approximation to the sampling distribution of <span class="math inline">\(T\)</span> under <span class="math inline">\(H_0\)</span> can be used, which has mean <span class="math inline">\(n(n + 1) / 4\)</span> and variance <span class="math inline">\(n(n + 1)(2n + 1)/24\)</span>.</p>
<hr />
<p><strong>Example 11:</strong> Ten patients are treated for high blood pressure. Use the Wilcoxon signed rank test to asses whether the treatment has had any effect on blood pressure. The patients’ blood pressures before and after treatment are given in the table below.</p>
<table>
<thead>
<tr class="header">
<th align="center">Patient</th>
<th align="right">1</th>
<th align="right">2</th>
<th align="right">3</th>
<th align="right">4</th>
<th align="right">5</th>
<th align="right">6</th>
<th align="right">7</th>
<th align="right">8</th>
<th align="right">9</th>
<th align="right">10</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">Before</td>
<td align="right">94</td>
<td align="right">105</td>
<td align="right">101</td>
<td align="right">106</td>
<td align="right">118</td>
<td align="right">107</td>
<td align="right">96</td>
<td align="right">102</td>
<td align="right">114</td>
<td align="right">95</td>
</tr>
<tr class="even">
<td align="center">After</td>
<td align="right">96</td>
<td align="right">96</td>
<td align="right">95</td>
<td align="right">103</td>
<td align="right">105</td>
<td align="right">111</td>
<td align="right">86</td>
<td align="right">90</td>
<td align="right">107</td>
<td align="right">84</td>
</tr>
</tbody>
</table>
<p>As we are interested in <em>any</em> effect, we need a two-sided test. So our hypotheses are <span class="math inline">\(H_0:\mu = 0\)</span> versus <span class="math inline">\(H_1:\mu \neq 0\)</span>. For patient <span class="math inline">\(i\)</span>, for <span class="math inline">\(i = 1, \ldots, 10\)</span>, let <span class="math inline">\(x_i\)</span> and <span class="math inline">\(y_i\)</span> denote the before and after blood pressures, respectively. It’s then useful to add four rows to the table, which are <span class="math inline">\(I(y_i &gt; x_i)\)</span>, <span class="math inline">\(I(x_i &gt; y_i)\)</span>, <span class="math inline">\(|y_i - x_i|\)</span> and <span class="math inline">\(r_i = \text{rank}(|y_i - x_i|)\)</span>.</p>
<table>
<thead>
<tr class="header">
<th align="center">Patient</th>
<th align="right">1</th>
<th align="right">2</th>
<th align="right">3</th>
<th align="right">4</th>
<th align="right">5</th>
<th align="right">6</th>
<th align="right">7</th>
<th align="right">8</th>
<th align="right">9</th>
<th align="right">10</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center"><span class="math inline">\(I(y_i &gt; x_i)\)</span></td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="center"><span class="math inline">\(I(x_i &gt; y_i)\)</span></td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="center"><span class="math inline">\(|y_i - x_i|\)</span></td>
<td align="right">2</td>
<td align="right">9</td>
<td align="right">6</td>
<td align="right">3</td>
<td align="right">13</td>
<td align="right">4</td>
<td align="right">10</td>
<td align="right">12</td>
<td align="right">7</td>
<td align="right">11</td>
</tr>
<tr class="even">
<td align="center"><span class="math inline">\(r_i\)</span></td>
<td align="right">1</td>
<td align="right">6</td>
<td align="right">4</td>
<td align="right">2</td>
<td align="right">10</td>
<td align="right">3</td>
<td align="right">7</td>
<td align="right">9</td>
<td align="right">5</td>
<td align="right">8</td>
</tr>
</tbody>
</table>
<p>We then have that <span class="math inline">\(t_{\text{obs},X} = \sum_{i = n} I(y_i &gt; x_i) r_i = 1 + 3 = 4\)</span> and <span class="math inline">\(t_{\text{obs},Y} = \sum_{i = n} I(x_i &gt; y_i) r_i = 6 + 4 + 2 + 10 + 7 + 9 + 5 + 8 = 51\)</span> and so <span class="math inline">\(t_\text{obs} = \min(t_{\text{obs},X}, t_{\text{obs},Y}) = \min(4, 53) = 4\)</span>. The <span class="math inline">\(p\)</span>-value for the test is therefore <span class="math inline">\(\text{Pr}(|T| &gt; |t_\text{obs}|) = 2 \text{Pr}(T &lt; t_\text{obs})\)</span>, which we can evaluate in <code>R</code> with</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="depsamp.html#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span> <span class="sc">*</span> <span class="fu">psignrank</span>(<span class="dv">4</span>, <span class="dv">10</span>)</span></code></pre></div>
<p>and gives an approximate <span class="math inline">\(p\)</span>-value of 0.0137. As <span class="math inline">\(0.01 &lt;\)</span> <span class="math inline">\(p\)</span>-value <span class="math inline">\(&lt; 0.05\)</span>, there is evidence to reject <span class="math inline">\(\mu = 0\)</span> in favour of <span class="math inline">\(\mu \neq 0\)</span> at the 5% significance level but not the 1% significance level. However, the evidence that the treatment has had an effect it is far from overwhelming<a href="#fn12" class="footnote-ref" id="fnref12"><sup>12</sup></a>. <span style="float:right;"> ⬛ </span> </p>
<hr />
</div>
</div>
<div class="footnotes">
<hr />
<ol start="11">
<li id="fn11"><p>The test statistic <span class="math inline">\(W = \sum_{i = 1}^n S_i R_i\)</span> is sometimes used instead of <span class="math inline">\(T\)</span>, where <span class="math inline">\(S_i = sgn(Y_i - X_i)\)</span> and <span class="math inline">\(sgn(u) = 1\)</span> if <span class="math inline">\(u &gt; 0\)</span>, <span class="math inline">\(sgn(u) = 0\)</span> if <span class="math inline">\(u = 0\)</span> and <span class="math inline">\(sgn(u) = -1\)</span> if <span class="math inline">\(u &lt; 0\)</span> is the sign function. For example, Wikipedia uses <span class="math inline">\(W\)</span>: see <a href="https://en.wikipedia.org/wiki/Wilcoxon_signed-rank_test" class="uri">https://en.wikipedia.org/wiki/Wilcoxon_signed-rank_test</a>. We’re using <span class="math inline">\(T\)</span> because <code>R</code> uses <span class="math inline">\(T\)</span>, and because its calculation is slightly less prone to error than that of <span class="math inline">\(W\)</span>. Note that normal approximations for <span class="math inline">\(W\)</span> differ from those for <span class="math inline">\(T\)</span>.<a href="depsamp.html#fnref11" class="footnote-back">↩︎</a></p></li>
<li id="fn12"><p>Note that in Example 11, we used the exact sampling distribution of the Wilcoxon signed rank test statistic. A normal approximation (which we’d usually do for <span class="math inline">\(n \geq 20\)</span>) would have had mean <span class="math inline">\(n(n + 1) / 4 = 27.5\)</span> and variance <span class="math inline">\(n(n + 1)(2n + 2) / 24 = 96.25\)</span>. This would have led to a test statistic of <span class="math inline">\(z_\text{obs} = -2.395\)</span>, and in turn a <span class="math inline">\(p\)</span>-value of <span class="math inline">\(\text{Pr}(|Z| \geq |z_\text{obs}|) = 2 \text{Pr}(Z \leq z_\text{obs}) = 0.0166\)</span>, and hence a similar conclusion to Example 11.<a href="depsamp.html#fnref12" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="permrand.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="summary.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": false,
"toc": {
"collapse": "subsection"
},
"toolbar": {
"position": "static"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
