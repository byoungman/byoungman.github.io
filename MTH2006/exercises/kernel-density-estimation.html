<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Kernel density estimation | Topic 5: Nonparametric statistics</title>
  <meta name="description" content="Kernel density estimation | Topic 5: Nonparametric statistics" />
  <meta name="generator" content="bookdown 0.29 and GitBook 2.6.7" />

  <meta property="og:title" content="Kernel density estimation | Topic 5: Nonparametric statistics" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Kernel density estimation | Topic 5: Nonparametric statistics" />
  
  
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="estimating-cdfs-and-pdfs-and-testing-their-goodness-of-fit.html"/>
<link rel="next" href="nonparametric-tests-for-two-independent-samples.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="exercises.html"><a href="exercises.html"><i class="fa fa-check"></i>Exercises</a></li>
<li class="chapter" data-level="" data-path="estimating-cdfs-and-pdfs-and-testing-their-goodness-of-fit.html"><a href="estimating-cdfs-and-pdfs-and-testing-their-goodness-of-fit.html"><i class="fa fa-check"></i>Estimating cdfs and pdfs, and testing their goodness of fit</a>
<ul>
<li class="chapter" data-level="" data-path="estimating-cdfs-and-pdfs-and-testing-their-goodness-of-fit.html"><a href="estimating-cdfs-and-pdfs-and-testing-their-goodness-of-fit.html#question-1"><i class="fa fa-check"></i>Question 1</a></li>
<li class="chapter" data-level="" data-path="estimating-cdfs-and-pdfs-and-testing-their-goodness-of-fit.html"><a href="estimating-cdfs-and-pdfs-and-testing-their-goodness-of-fit.html#question-2"><i class="fa fa-check"></i>Question 2</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="kernel-density-estimation.html"><a href="kernel-density-estimation.html"><i class="fa fa-check"></i>Kernel density estimation</a>
<ul>
<li class="chapter" data-level="" data-path="kernel-density-estimation.html"><a href="kernel-density-estimation.html#question-3"><i class="fa fa-check"></i>Question 3</a></li>
<li class="chapter" data-level="" data-path="kernel-density-estimation.html"><a href="kernel-density-estimation.html#question-4"><i class="fa fa-check"></i>Question 4</a></li>
<li class="chapter" data-level="" data-path="kernel-density-estimation.html"><a href="kernel-density-estimation.html#question-5"><i class="fa fa-check"></i>Question 5</a></li>
<li class="chapter" data-level="" data-path="kernel-density-estimation.html"><a href="kernel-density-estimation.html#question-6"><i class="fa fa-check"></i>Question 6</a></li>
<li class="chapter" data-level="" data-path="kernel-density-estimation.html"><a href="kernel-density-estimation.html#question-7"><i class="fa fa-check"></i>Question 7</a></li>
<li class="chapter" data-level="" data-path="kernel-density-estimation.html"><a href="kernel-density-estimation.html#question-8"><i class="fa fa-check"></i>Question 8</a></li>
<li class="chapter" data-level="" data-path="kernel-density-estimation.html"><a href="kernel-density-estimation.html#question-9"><i class="fa fa-check"></i>Question 9</a></li>
<li class="chapter" data-level="" data-path="kernel-density-estimation.html"><a href="kernel-density-estimation.html#question-10"><i class="fa fa-check"></i>Question 10</a></li>
<li class="chapter" data-level="" data-path="kernel-density-estimation.html"><a href="kernel-density-estimation.html#question-11"><i class="fa fa-check"></i>Question 11</a></li>
<li class="chapter" data-level="" data-path="kernel-density-estimation.html"><a href="kernel-density-estimation.html#question-12"><i class="fa fa-check"></i>Question 12</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="nonparametric-tests-for-two-independent-samples.html"><a href="nonparametric-tests-for-two-independent-samples.html"><i class="fa fa-check"></i>Nonparametric tests for two independent samples</a>
<ul>
<li class="chapter" data-level="" data-path="nonparametric-tests-for-two-independent-samples.html"><a href="nonparametric-tests-for-two-independent-samples.html#question-13"><i class="fa fa-check"></i>Question 13</a></li>
<li class="chapter" data-level="" data-path="nonparametric-tests-for-two-independent-samples.html"><a href="nonparametric-tests-for-two-independent-samples.html#question-14"><i class="fa fa-check"></i>Question 14</a></li>
<li class="chapter" data-level="" data-path="nonparametric-tests-for-two-independent-samples.html"><a href="nonparametric-tests-for-two-independent-samples.html#question-15"><i class="fa fa-check"></i>Question 15</a></li>
<li class="chapter" data-level="" data-path="nonparametric-tests-for-two-independent-samples.html"><a href="nonparametric-tests-for-two-independent-samples.html#question-16"><i class="fa fa-check"></i>Question 16</a></li>
<li class="chapter" data-level="" data-path="nonparametric-tests-for-two-independent-samples.html"><a href="nonparametric-tests-for-two-independent-samples.html#happy"><i class="fa fa-check"></i>Question 17</a></li>
<li class="chapter" data-level="" data-path="nonparametric-tests-for-two-independent-samples.html"><a href="nonparametric-tests-for-two-independent-samples.html#question-18"><i class="fa fa-check"></i>Question 18</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="nonparametric-tests-for-two-dependent-samples.html"><a href="nonparametric-tests-for-two-dependent-samples.html"><i class="fa fa-check"></i>Nonparametric tests for two dependent samples</a>
<ul>
<li class="chapter" data-level="" data-path="nonparametric-tests-for-two-dependent-samples.html"><a href="nonparametric-tests-for-two-dependent-samples.html#question-19"><i class="fa fa-check"></i>Question 19</a></li>
<li class="chapter" data-level="" data-path="nonparametric-tests-for-two-dependent-samples.html"><a href="nonparametric-tests-for-two-dependent-samples.html#question-20"><i class="fa fa-check"></i>Question 20</a></li>
<li class="chapter" data-level="" data-path="nonparametric-tests-for-two-dependent-samples.html"><a href="nonparametric-tests-for-two-dependent-samples.html#question-21"><i class="fa fa-check"></i>Question 21</a></li>
<li class="chapter" data-level="" data-path="nonparametric-tests-for-two-dependent-samples.html"><a href="nonparametric-tests-for-two-dependent-samples.html#question-22"><i class="fa fa-check"></i>Question 22</a></li>
<li class="chapter" data-level="" data-path="nonparametric-tests-for-two-dependent-samples.html"><a href="nonparametric-tests-for-two-dependent-samples.html#question-23"><i class="fa fa-check"></i>Question 23</a></li>
<li class="chapter" data-level="" data-path="nonparametric-tests-for-two-dependent-samples.html"><a href="nonparametric-tests-for-two-dependent-samples.html#question-24"><i class="fa fa-check"></i>Question 24</a></li>
<li class="chapter" data-level="" data-path="nonparametric-tests-for-two-dependent-samples.html"><a href="nonparametric-tests-for-two-dependent-samples.html#question-25"><i class="fa fa-check"></i>Question 25</a></li>
<li class="chapter" data-level="" data-path="nonparametric-tests-for-two-dependent-samples.html"><a href="nonparametric-tests-for-two-dependent-samples.html#question-26"><i class="fa fa-check"></i>Question 26</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Topic 5: Nonparametric statistics</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="kernel-density-estimation" class="section level1 hasAnchor">
<h1>Kernel density estimation<a href="kernel-density-estimation.html#kernel-density-estimation" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="question-3" class="section level2 hasAnchor">
<h2>Question 3<a href="kernel-density-estimation.html#question-3" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>(5.4.1) Consider kernel density estimates for the Old Faithful geyser eruption data using the normal, Epanechnikov, rectangular and triangular kernels.</p>
<ol style="list-style-type: lower-alpha">
<li>(5.4.5) Plot density estimates for <code>bw = 0.05</code>. Comment on the differences that you observe. [Note that <code>R</code> will rescale <code>bw</code> and so does not directly correspond to <span class="math inline">\(h\)</span> from the lecture notes. You may use either <code>density(...)</code> or <code>ggplot(...) + geom_density(...)</code>.]</li>
</ol>
<hr />
<details>
<summary>
<strong>Solution</strong>
</summary>
<p>The following plots kernel density estimates for the four different kernel functions and <code>bw = 0.05</code> with <code>ggplot2</code>.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="kernel-density-estimation.html#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gridExtra)</span>
<span id="cb35-2"><a href="kernel-density-estimation.html#cb35-2" aria-hidden="true" tabindex="-1"></a>kernels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;gaussian&quot;</span>, <span class="st">&quot;epanechnikov&quot;</span>, <span class="st">&quot;rectangular&quot;</span>, <span class="st">&quot;triangular&quot;</span>)</span>
<span id="cb35-3"><a href="kernel-density-estimation.html#cb35-3" aria-hidden="true" tabindex="-1"></a>titles <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Normal&quot;</span>, <span class="st">&quot;Epanechnikov&quot;</span>, <span class="st">&quot;Rectangular&quot;</span>, <span class="st">&quot;Triangular&quot;</span>)</span>
<span id="cb35-4"><a href="kernel-density-estimation.html#cb35-4" aria-hidden="true" tabindex="-1"></a>ggplots <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb35-5"><a href="kernel-density-estimation.html#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(kernels)) {</span>
<span id="cb35-6"><a href="kernel-density-estimation.html#cb35-6" aria-hidden="true" tabindex="-1"></a>  ggplots[[i]] <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(faithful, <span class="fu">aes</span>(<span class="at">x =</span> eruptions)) <span class="sc">+</span></span>
<span id="cb35-7"><a href="kernel-density-estimation.html#cb35-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_density</span>(<span class="at">kernel =</span> kernels[i], <span class="at">bw =</span> .<span class="dv">05</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(titles[i])</span>
<span id="cb35-8"><a href="kernel-density-estimation.html#cb35-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb35-9"><a href="kernel-density-estimation.html#cb35-9" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(<span class="at">grobs =</span> ggplots)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-32"></span>
<img src="exercises_files/figure-html/unnamed-chunk-32-1.png" alt="Kernel density estimates based on various kernel functions." width="672" />
<p class="caption">
Figure 8: Kernel density estimates based on various kernel functions.
</p>
</div>
<p>Alternatively, with <code>base</code> graphics, we could use the following.</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="kernel-density-estimation.html#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>))</span>
<span id="cb36-2"><a href="kernel-density-estimation.html#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(kernels)) {</span>
<span id="cb36-3"><a href="kernel-density-estimation.html#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(<span class="fu">density</span>(faithful<span class="sc">$</span>eruptions, <span class="at">kernel =</span> kernels[i], <span class="at">bw =</span> .<span class="dv">05</span>),</span>
<span id="cb36-4"><a href="kernel-density-estimation.html#cb36-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">main =</span> titles[i])</span>
<span id="cb36-5"><a href="kernel-density-estimation.html#cb36-5" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Whichever way we plot the kernel density estimates, the results are the same. The normal, Epanechnikov and triangular kernels appear to give similar results. The rectangular kernel, however, gives a rather jagged density estimate. Ultimately we want a kernel density estimate to represent the pdf from which we think a sample has been drawn. Each of these kernel density estimates seems too wiggly.</p>
</details>
<hr />
<ol start="2" style="list-style-type: lower-alpha">
<li>(5.4.4) Use trial and error to find sensible values of <code>bw</code> for the normal and Epanechnikov kernels.</li>
</ol>
<hr />
<details>
<summary>
<strong>Solution</strong>
</summary>
<p>Let’s consider the values 0.02, 0.05, 0.1, 0.2, 0.5 and 1.0 for <code>bw</code> for the normal kernel function.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="kernel-density-estimation.html#cb37-1" aria-hidden="true" tabindex="-1"></a>bws <span class="ot">&lt;-</span> <span class="fu">c</span>(.<span class="dv">02</span>, .<span class="dv">05</span>, .<span class="dv">1</span>, .<span class="dv">2</span>, .<span class="dv">5</span>, <span class="dv">1</span>)</span>
<span id="cb37-2"><a href="kernel-density-estimation.html#cb37-2" aria-hidden="true" tabindex="-1"></a>ggplots <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb37-3"><a href="kernel-density-estimation.html#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(bws)) {</span>
<span id="cb37-4"><a href="kernel-density-estimation.html#cb37-4" aria-hidden="true" tabindex="-1"></a>  ggplots[[i]] <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(faithful, <span class="fu">aes</span>(<span class="at">x =</span> eruptions)) <span class="sc">+</span></span>
<span id="cb37-5"><a href="kernel-density-estimation.html#cb37-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_density</span>(<span class="at">bw =</span> bws[i]) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="fu">paste</span>(<span class="st">&quot;bw =&quot;</span>, bws[i]))</span>
<span id="cb37-6"><a href="kernel-density-estimation.html#cb37-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb37-7"><a href="kernel-density-estimation.html#cb37-7" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(<span class="at">grobs =</span> ggplots)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-34"></span>
<img src="exercises_files/figure-html/unnamed-chunk-34-1.png" alt="Kernel density estimates of the pdf of Old Faithful geyser eruption times based on a normal kernel function with different values of \texttt{bw}." width="768" />
<p class="caption">
Figure 9: Kernel density estimates of the pdf of Old Faithful geyser eruption times based on a normal kernel function with different values of .
</p>
</div>
<p>There’s no right answer here, but <code>bw = 0.02</code> and <code>bw = 0.05</code> give estimates that are wigglier than we’d probably expect the underlying pdf of eruption times to be; conversely <code>bw = 0.5</code> and <code>bw = 1</code> probably give too smooth estimates. The most sensible values appear to be <code>bw = 0.1</code> or <code>bw = 0.2</code>. We could explore values within this range, but won’t here.</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="kernel-density-estimation.html#cb38-1" aria-hidden="true" tabindex="-1"></a>bws <span class="ot">&lt;-</span> <span class="fu">c</span>(.<span class="dv">02</span>, .<span class="dv">05</span>, .<span class="dv">1</span>, .<span class="dv">2</span>, .<span class="dv">5</span>, <span class="dv">1</span>)</span>
<span id="cb38-2"><a href="kernel-density-estimation.html#cb38-2" aria-hidden="true" tabindex="-1"></a>ggplots <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb38-3"><a href="kernel-density-estimation.html#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(bws)) {</span>
<span id="cb38-4"><a href="kernel-density-estimation.html#cb38-4" aria-hidden="true" tabindex="-1"></a>  ggplots[[i]] <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(faithful, <span class="fu">aes</span>(<span class="at">x =</span> eruptions)) <span class="sc">+</span></span>
<span id="cb38-5"><a href="kernel-density-estimation.html#cb38-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_density</span>(<span class="at">bw =</span> bws[i], <span class="at">kernel =</span> <span class="st">&quot;rectangular&quot;</span>) <span class="sc">+</span> </span>
<span id="cb38-6"><a href="kernel-density-estimation.html#cb38-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="fu">paste</span>(<span class="st">&quot;bw =&quot;</span>, bws[i]))</span>
<span id="cb38-7"><a href="kernel-density-estimation.html#cb38-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb38-8"><a href="kernel-density-estimation.html#cb38-8" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(<span class="at">grobs =</span> ggplots)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-35"></span>
<img src="exercises_files/figure-html/unnamed-chunk-35-1.png" alt="Kernel density estimates of the pdf of Old Faithful geyser eruption times based on a rectangular kernel function with different values of \texttt{bw}." width="768" />
<p class="caption">
Figure 10: Kernel density estimates of the pdf of Old Faithful geyser eruption times based on a rectangular kernel function with different values of .
</p>
</div>
<p>The rectangular kernel function’s performance is relatively poor across all bandwidths, if we expect that the underlying pdf of the eruption times is smooth. Nonetheless, <code>bw = 0.2</code> is probably best.</p>
<p>Note that if we further increase <code>bw</code>, for either kernel function, we gradually remove the trough around 3 minutes; by doing so we are losing information in the sample of data about their underlying pdf by over-smoothing our kernel density estimate of the pdf. Such over-smoothing should be avoided.</p>
</details>
<hr />
</div>
<div id="question-4" class="section level2 hasAnchor">
<h2>Question 4<a href="kernel-density-estimation.html#question-4" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>(5.4.3) If a variable <span class="math inline">\(U\)</span> has pdf <span class="math inline">\(f_U(u) = w(u)\)</span>, where <span class="math inline">\(w(u)\)</span> is the triangular kernel function, find <span class="math inline">\(\text{E}(U)\)</span> and <span class="math inline">\(\text{Var}(U)\)</span> and hence propose a transformation of the form <span class="math inline">\(aU\)</span> such that the triangular kernel function can be modified to have unit variance.</p>
<hr />
<details>
<summary>
<strong>Solution</strong>
</summary>
<p>First note that <span class="math inline">\(\text{Var}(U) = \text{E}(U^2) - [\text{E}(U)]^2\)</span>. Then <span class="math display">\[\begin{align*} \text{E}(U) = \int_{-1}^1 t(1 - |t|) \text{d}t &amp;= \int_{-1}^0 t[1 - (-t)] \text{d}t + \int_0^1 t(1 - t) \text{d}t\\ &amp;= \left[\dfrac{t^2}{2} + \dfrac{t^3}{3}\right]_{-1}^0 + \left[\dfrac{t^2}{2} - \dfrac{t^3}{3}\right]_0^1\\ &amp;= \left[0 - \left(\dfrac{1}{2} + \dfrac{-1}{3}\right)\right] + \left[\left(\dfrac{1}{2} - \dfrac{1}{3}\right) - 0\right] = -\dfrac{1}{6} + \dfrac{1}{6} = 0\end{align*}\]</span> and <span class="math display">\[\begin{align*} \text{E}(U^2) = \int_{-1}^1 t^2 (1 - |t|) \text{d}t &amp;= \int_{-1}^0 t^2 [1 - (-t)] \text{d}t + \int_{-1}^0 t^2 (1 - t) \text{d}t\\ &amp;= \left[\dfrac{t^3}{3} + \dfrac{t^4}{4}\right]_{-1}^0 + \left[\dfrac{t^3}{3} - \dfrac{t^4}{4}\right]_0^1\\ &amp;= \left[0 - \left(-\dfrac{1}{3} + \dfrac{1}{4}\right)\right] + \left[\left(\dfrac{1}{3} - \dfrac{1}{4}\right) - 0\right] = \dfrac{1}{12} + \dfrac{1}{12} = \dfrac{1}{6}\end{align*}\]</span> As <span class="math inline">\(\text{E}(U)= 0\)</span>, <span class="math inline">\(\text{Var}(U) = \text{E}(U^2) = \frac{1}{6}\)</span>. Since <span class="math inline">\(\text{Var}(aU) = a^2 \text{Var}(U)\)</span>, we need <span class="math inline">\(\frac{a^2}{6} = 1\)</span>. Hence <span class="math inline">\(a = \sqrt{6}\)</span> and so <span class="math inline">\(\sqrt{6}U\)</span> has unit variance.</p>
</details>
<hr />
</div>
<div id="question-5" class="section level2 hasAnchor">
<h2>Question 5<a href="kernel-density-estimation.html#question-5" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Consider a kernel density estimate, <span class="math inline">\(\widehat f_h(y)\)</span>, for the Exeter Airport wind speeds of Question 2. The following function evaluates <span class="math inline">\(\widehat f_h(y)\)</span>, a kernel density estimate for bandwidth at value(s) for kernel function based on sample .</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="kernel-density-estimation.html#cb39-1" aria-hidden="true" tabindex="-1"></a>kde <span class="ot">&lt;-</span> <span class="cf">function</span>(y, data, w, h) {</span>
<span id="cb39-2"><a href="kernel-density-estimation.html#cb39-2" aria-hidden="true" tabindex="-1"></a>  d <span class="ot">&lt;-</span> <span class="fu">outer</span>(y, data, <span class="at">FUN =</span> <span class="st">&quot;-&quot;</span>)</span>
<span id="cb39-3"><a href="kernel-density-estimation.html#cb39-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowMeans</span>(<span class="fu">w</span>(d <span class="sc">/</span> h)) <span class="sc">/</span> h</span>
<span id="cb39-4"><a href="kernel-density-estimation.html#cb39-4" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>[Note that returns a <span class="math inline">\(m \times n\)</span> matrix, if supplied an <span class="math inline">\(m\)</span>-vector , i.e. <span class="math inline">\((x_1, \ldots, x_m)&#39;\)</span>, and <span class="math inline">\(n\)</span>-vector , i.e. <span class="math inline">\((y_1, \ldots, y_n)&#39;\)</span>. Specifying stipulates to use the minus function, so that the matrix’s <span class="math inline">\((i, j)\)</span>th element is <span class="math inline">\(x_i - y_j\)</span>, for <span class="math inline">\(i = 1, \ldots, m\)</span> and <span class="math inline">\(j = 1, \ldots, n\)</span>. Also note that there are many other ways of writing a function to evaluate <span class="math inline">\(\widehat f_h(y)\)</span>.]</p>
<ol style="list-style-type: lower-alpha">
<li>Write a function to evaluate the rectangular kernel function.</li>
</ol>
<hr />
<details>
<summary>
<strong>Solution</strong>
</summary>
<p>The following function is one option for evaluating the rectangular kernel function.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="kernel-density-estimation.html#cb40-1" aria-hidden="true" tabindex="-1"></a>w_rectangular <span class="ot">&lt;-</span> <span class="cf">function</span>(u) <span class="fu">ifelse</span>(<span class="fu">abs</span>(u) <span class="sc">&lt;=</span> <span class="dv">1</span>, <span class="fl">0.5</span>, <span class="dv">0</span>)</span></code></pre></div>
<p>The above function may be thought of as a more compact version of something like this.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="kernel-density-estimation.html#cb41-1" aria-hidden="true" tabindex="-1"></a>w_rectangular_verbose <span class="ot">&lt;-</span> <span class="cf">function</span>(u) {</span>
<span id="cb41-2"><a href="kernel-density-estimation.html#cb41-2" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">length</span>(u)</span>
<span id="cb41-3"><a href="kernel-density-estimation.html#cb41-3" aria-hidden="true" tabindex="-1"></a>w <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n)</span>
<span id="cb41-4"><a href="kernel-density-estimation.html#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n) {</span>
<span id="cb41-5"><a href="kernel-density-estimation.html#cb41-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">abs</span>(u[i]) <span class="sc">&lt;=</span> <span class="dv">1</span>) {</span>
<span id="cb41-6"><a href="kernel-density-estimation.html#cb41-6" aria-hidden="true" tabindex="-1"></a>    w[i] <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb41-7"><a href="kernel-density-estimation.html#cb41-7" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb41-8"><a href="kernel-density-estimation.html#cb41-8" aria-hidden="true" tabindex="-1"></a>    w[i] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb41-9"><a href="kernel-density-estimation.html#cb41-9" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb41-10"><a href="kernel-density-estimation.html#cb41-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb41-11"><a href="kernel-density-estimation.html#cb41-11" aria-hidden="true" tabindex="-1"></a>w  </span>
<span id="cb41-12"><a href="kernel-density-estimation.html#cb41-12" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>We can check that they both give the same answer</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="kernel-density-estimation.html#cb42-1" aria-hidden="true" tabindex="-1"></a>u_seq <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">runif</span>(<span class="dv">10</span>, <span class="sc">-</span><span class="fl">1.5</span>, <span class="fl">1.5</span>), <span class="dv">2</span>)</span>
<span id="cb42-2"><a href="kernel-density-estimation.html#cb42-2" aria-hidden="true" tabindex="-1"></a>u_seq</span></code></pre></div>
<pre><code>##  [1] -0.21 -0.98  0.62  0.89  0.11  1.34  0.10 -0.41 -0.96 -0.53</code></pre>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="kernel-density-estimation.html#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">w_rectangular</span>(u_seq)</span></code></pre></div>
<pre><code>##  [1] 0.5 0.5 0.5 0.5 0.5 0.0 0.5 0.5 0.5 0.5</code></pre>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="kernel-density-estimation.html#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">w_rectangular_verbose</span>(u_seq)</span></code></pre></div>
<pre><code>##  [1] 0.5 0.5 0.5 0.5 0.5 0.0 0.5 0.5 0.5 0.5</code></pre>
<p>which they do, for these <span class="math inline">\(u\)</span> values.</p>
</details>
<hr />
<ol start="2" style="list-style-type: lower-alpha">
<li>Use the function <code>kde()</code> to evaluate <span class="math inline">\(\widehat f_h(y)\)</span> for the wind speeds with <span class="math inline">\(y = 1, 1.5, 2, \ldots, 5, 5.5\)</span>, bandwidth <span class="math inline">\(h = 1.5\)</span> and a rectangular kernel function.</li>
</ol>
<hr />
<details>
<summary>
<strong>Solution</strong>
</summary>
<p>We’ll start by loading the wind speeds</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="kernel-density-estimation.html#cb48-1" aria-hidden="true" tabindex="-1"></a>exeter2019 <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;exeter2019.csv&quot;</span>)</span>
<span id="cb48-2"><a href="kernel-density-estimation.html#cb48-2" aria-hidden="true" tabindex="-1"></a>ws <span class="ot">&lt;-</span> exeter2019<span class="sc">$</span>wind_speed</span></code></pre></div>
<p>To evaluate <span class="math inline">\(\widehat f_h(y)\)</span> for the <span class="math inline">\(y\)</span> values specified and bandwidth <span class="math inline">\(h = 1.5\)</span> we then just need to issue the following:</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="kernel-density-estimation.html#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">kde</span>(<span class="fu">seq</span>(<span class="dv">1</span>, <span class="fl">5.5</span>, <span class="at">by =</span> <span class="fl">0.5</span>), ws, w_rectangular, <span class="fl">1.5</span>)</span></code></pre></div>
<pre><code>##  [1] 0.01552511 0.03013699 0.05022831 0.07397260 0.10410959 0.11872146
##  [7] 0.13333333 0.13607306 0.13789954 0.12968037</code></pre>
</details>
<hr />
<ol start="3" style="list-style-type: lower-alpha">
<li>Re-evaluate <span class="math inline">\(\widehat f_h(y)\)</span> for <span class="math inline">\(y = 1, 1.5, 2, \ldots, 5, 5.5\)</span> for bandwidth <span class="math inline">\(h = 1.5\)</span> using the Epanechnikov kernel function instead. Then plot <span class="math inline">\(\widehat f_h(y)\)</span> over a sensible range.</li>
</ol>
<hr />
<details>
<summary>
<strong>Solution</strong>
</summary>
<p>Here’s a function to evaluate the Epanechnikov kernel</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="kernel-density-estimation.html#cb51-1" aria-hidden="true" tabindex="-1"></a>w_epanechnikov <span class="ot">&lt;-</span> <span class="cf">function</span>(u) <span class="fu">ifelse</span> (<span class="fu">abs</span>(u) <span class="sc">&lt;</span> <span class="dv">1</span>, <span class="dv">3</span> <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> u<span class="sc">^</span><span class="dv">2</span>) <span class="sc">/</span> <span class="dv">4</span>, <span class="dv">0</span>)</span></code></pre></div>
<p>and then <span class="math inline">\(\widehat f_h(y)\)</span> can be evaluated, as above, using the following:</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="kernel-density-estimation.html#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">kde</span>(<span class="fu">seq</span>(<span class="dv">1</span>, <span class="fl">5.5</span>, <span class="at">by =</span> <span class="fl">0.5</span>), ws, w_epanechnikov, <span class="fl">1.5</span>)</span></code></pre></div>
<pre><code>##  [1] 0.01312257 0.02566802 0.04560079 0.07104101 0.10209658 0.12856842
##  [7] 0.14069049 0.14159956 0.13203805 0.12030674</code></pre>
<p>Finally, we’ll plot the function over the range of the data <span class="math inline">\(\pm 2h\)</span>, using <code>pretty()</code> to choose roughly 200 ‘nice’ values.</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="kernel-density-estimation.html#cb54-1" aria-hidden="true" tabindex="-1"></a>h <span class="ot">&lt;-</span> <span class="fl">1.5</span></span>
<span id="cb54-2"><a href="kernel-density-estimation.html#cb54-2" aria-hidden="true" tabindex="-1"></a>y_plot <span class="ot">&lt;-</span> <span class="fu">pretty</span>(<span class="fu">range</span>(exeter2019<span class="sc">$</span>wind_speed) <span class="sc">+</span> <span class="dv">2</span> <span class="sc">*</span> h <span class="sc">*</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>), <span class="dv">200</span>)</span>
<span id="cb54-3"><a href="kernel-density-estimation.html#cb54-3" aria-hidden="true" tabindex="-1"></a>f_hat <span class="ot">&lt;-</span> <span class="fu">kde</span>(y_plot, ws, w_epanechnikov, h)</span>
<span id="cb54-4"><a href="kernel-density-estimation.html#cb54-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> y_plot, <span class="at">y =</span> f_hat)) <span class="sc">+</span></span>
<span id="cb54-5"><a href="kernel-density-estimation.html#cb54-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;y&quot;</span>, <span class="at">y =</span> <span class="fu">expression</span>(<span class="fu">hat</span>(f[h])(y)))</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-44"></span>
<img src="exercises_files/figure-html/unnamed-chunk-44-1.png" alt="Kernel density estimate for Exeter airport wind speeds based on Epanechnikov kernel function and bandwidth $h = 1.5$." width="384" />
<p class="caption">
Figure 11: Kernel density estimate for Exeter airport wind speeds based on Epanechnikov kernel function and bandwidth <span class="math inline">\(h = 1.5\)</span>.
</p>
</div>
</details>
<hr />
</div>
<div id="question-6" class="section level2 hasAnchor">
<h2>Question 6<a href="kernel-density-estimation.html#question-6" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Let <span class="math inline">\(\mathbf{y} = (y_1, \ldots, y_n)\)</span> denote the non-zero Teignmouth daily rainfall amounts for 2019 and let <span class="math inline">\(\mathbf{z} = (z_1, \ldots, z_n)\)</span>, where <span class="math inline">\(z_i = \log(y_i)\)</span> for <span class="math inline">\(i = 1, \ldots, n\)</span>. Then
<span class="math display">\[
\widehat f_{z, h}(z) = \dfrac{1}{nh} \sum_{i = 1}^n w\left(\dfrac{z - z_i}{h}\right)
\]</span>
gives a kernel density estimate of the log-transformed non-zero rainfall amounts. We can directly produce an estimate of the pdf of the <em>actual</em> rainfall amounts with
<span class="math display">\[
\widehat f_{y, h}(y) = \dfrac{\widehat f_{z, h}(\log y)}{y}.
\]</span></p>
<ol style="list-style-type: lower-alpha">
<li>Use function <code>kde()</code> from Question 5 to estimate and then plot a kernel density estimate for the log-transformed non-zero rainfall amounts using <span class="math inline">\(h = 0.6\)</span> and a normal kernel function.</li>
</ol>
<hr />
<details>
<summary>
<strong>Solution</strong>
</summary>
<p>We’ll load the Teignmouth 2019 rainfall data, extract the non-zero data, and store the non-zero amounts as <code>z</code>.</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="kernel-density-estimation.html#cb55-1" aria-hidden="true" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="st">&#39;https://byoungman.github.io/data/teignmouth2019.csv&#39;</span></span>
<span id="cb55-2"><a href="kernel-density-estimation.html#cb55-2" aria-hidden="true" tabindex="-1"></a>teignmouth <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(url)</span>
<span id="cb55-3"><a href="kernel-density-estimation.html#cb55-3" aria-hidden="true" tabindex="-1"></a>rain <span class="ot">&lt;-</span> <span class="fu">subset</span>(teignmouth, prcp <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb55-4"><a href="kernel-density-estimation.html#cb55-4" aria-hidden="true" tabindex="-1"></a>z <span class="ot">&lt;-</span> <span class="fu">log</span>(rain<span class="sc">$</span>prcp)</span></code></pre></div>
<p>Then we’ll set the bandwidth as <code>h</code>, use <code>pretty()</code> to choose appropriate plotting values, and use <code>kde()</code> to calculate the kernel density estimate.</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="kernel-density-estimation.html#cb56-1" aria-hidden="true" tabindex="-1"></a>h <span class="ot">&lt;-</span> .<span class="dv">6</span></span>
<span id="cb56-2"><a href="kernel-density-estimation.html#cb56-2" aria-hidden="true" tabindex="-1"></a>z_plot <span class="ot">&lt;-</span> <span class="fu">pretty</span>(<span class="fu">range</span>(z) <span class="sc">+</span> h <span class="sc">*</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>), <span class="dv">200</span>)</span>
<span id="cb56-3"><a href="kernel-density-estimation.html#cb56-3" aria-hidden="true" tabindex="-1"></a>f_hat <span class="ot">&lt;-</span> <span class="fu">kde</span>(z_plot, z, dnorm, h)</span></code></pre></div>
<p>The following then plots the estimate.</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="kernel-density-estimation.html#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> z_plot, <span class="at">y =</span> f_hat)) <span class="sc">+</span></span>
<span id="cb57-2"><a href="kernel-density-estimation.html#cb57-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;z&quot;</span>, <span class="at">y =</span> <span class="fu">expression</span>(<span class="fu">hat</span>(f[h])(z)))</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-47"></span>
<img src="exercises_files/figure-html/unnamed-chunk-47-1.png" alt="Kernel density estimate for log-transformed non-zero rainfall amounts." width="384" />
<p class="caption">
Figure 12: Kernel density estimate for log-transformed non-zero rainfall amounts.
</p>
</div>
</details>
<hr />
<ol start="2" style="list-style-type: lower-alpha">
<li>Use your estimate from part (a) to plot the estimated pdf of the actual non-zero rainfall amounts (i.e. on their original scale) based on the kernel density estimate of the log-transformed amounts.</li>
</ol>
<hr />
<details>
<summary>
<strong>Solution</strong>
</summary>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="kernel-density-estimation.html#cb58-1" aria-hidden="true" tabindex="-1"></a>f_hat_y <span class="ot">&lt;-</span> f_hat <span class="sc">/</span> <span class="fu">exp</span>(z_plot)</span>
<span id="cb58-2"><a href="kernel-density-estimation.html#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">exp</span>(z_plot), <span class="at">y =</span> f_hat_y)) <span class="sc">+</span></span>
<span id="cb58-3"><a href="kernel-density-estimation.html#cb58-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;y&quot;</span>, <span class="at">y =</span> <span class="fu">expression</span>(<span class="fu">hat</span>(f[h])(y))) <span class="sc">+</span> <span class="fu">xlim</span>(<span class="dv">0</span>, <span class="dv">30</span>)</span></code></pre></div>
<pre><code>## Warning: Removed 19 rows containing missing values (`geom_line()`).</code></pre>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-48"></span>
<img src="exercises_files/figure-html/unnamed-chunk-48-1.png" alt="Estimate of pdf of non-zero rainfall amounts based on kernel density estimate of log-transformed amounts." width="384" />
<p class="caption">
Figure 13: Estimate of pdf of non-zero rainfall amounts based on kernel density estimate of log-transformed amounts.
</p>
</div>
<!-- Write a function, `f_log(y, y_i, h)`, to implement this log-transformed kernel density approximation using the normal kernel function, where `y_i` $= \mathbf{y}$, `y` $= y$ and `h` $= h$. -->
<p>We see here that what looks a sensible estimate on the logarithmic scale becomes rather less informative once transformed back to the original. In some sense, the logarithmic transformation is quite an anti-conservative transformation; something more conservative would be better on this occasion.</p>
</details>
<hr />
</div>
<div id="question-7" class="section level2 hasAnchor">
<h2>Question 7<a href="kernel-density-estimation.html#question-7" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>(5.4.6) Consider an iid random sample <span class="math inline">\(Y_1, \ldots, Y_n\)</span> with pdf <span class="math inline">\(f_Y(y) = \phi(y)\)</span>, where <span class="math inline">\(\phi()\)</span> denotes the standard normal distribution. Show that a kernel density estimate, <span class="math inline">\(\widehat f_h(y)\)</span>, with bandwidth <span class="math inline">\(h\)</span> has approximate bias <span class="math display">\[\dfrac{h^2 \sigma_w^2 (y^2 - 1)}{2\sqrt{2 \pi}} \text{e}^{-y^2/2}\]</span> based on a Taylor series expansion and a kernel function <span class="math inline">\(w(\,)\)</span> with variance <span class="math inline">\(\sigma_w^2\)</span>.</p>
<hr />
<details>
<summary>
<strong>Solution</strong>
</summary>
<p>Based on a Taylor series expansion, the approximate bias is <span class="math display">\[\begin{equation} \label{bias} \text{E}[\widehat f_h(y)] - f_Y(y) \simeq \dfrac{h^2 \sigma_w^2}{2}f&#39;&#39;_Y(y).\end{equation}\]</span> For the standard normal distribution <span class="math inline">\(f_Y(y) = \frac{1}{\sqrt{2 \pi}} \text{e}^{-y^2/2}\)</span>. So <span class="math inline">\(f&#39;_Y(y) = -\frac{y}{\sqrt{2 \pi}} \text{e}^{-y^2/2}\)</span> and then <span class="math display">\[f&#39;&#39;_Y(y) = -\dfrac{1}{\sqrt{2 \pi}} \text{e}^{-y^2/2} + \dfrac{y^2}{\sqrt{2 \pi}}\text{e}^{-y^2/2} = \dfrac{y^2 - 1}{\sqrt{2\pi}}\text{e}^{-y^2/2}.\]</span> Substituting the result for <span class="math inline">\(f&#39;&#39;_Y(y)\)</span> back into Eq. <span class="math inline">\(\eqref{bias}\)</span>, we get that the bias is approximately <span class="math display">\[\text{E}[\widehat f_h(y)] - f_Y(y) \simeq \dfrac{h^2 \sigma_w^2 (y^2 - 1)}{2\sqrt{2 \pi}} \text{e}^{-y^2/2}.\]</span></p>
</details>
<hr />
</div>
<div id="question-8" class="section level2 hasAnchor">
<h2>Question 8<a href="kernel-density-estimation.html#question-8" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Consider an iid random sample <span class="math inline">\(Y_1, \ldots, Y_n\)</span> with pdf <span class="math inline">\(f_Y(y)\)</span>. Show that, based on a Taylor expansion, the variance of a kernel density estimate, <span class="math inline">\(\widehat f_h(y)\)</span>, with bandwidth <span class="math inline">\(h\)</span> is approximately <span class="math inline">\(\pi^2 f_Y(y) / (16nh)\)</span> for the cosine kernel function.</p>
<hr />
<details>
<summary>
<strong>Solution</strong>
</summary>
<p>Based on a Taylor series expansion <span class="math display">\[\begin{align*} \text{Var}[\widehat f_h(y)] &amp;\simeq \dfrac{1}{nh}f_Y(y) \int_{-1}^1 w^2(u) \text{d}u \\ &amp;= \dfrac{1}{nh}f_Y(y) \int_{-1}^1 \left[\dfrac{\pi}{4} \cos\left(\dfrac{\pi}{2} u\right)\right]^2 \text{d}u = \dfrac{\pi^2}{16nh}f_Y(y) \int_{-1}^1 \cos^2\left(\dfrac{\pi}{2} u\right) \text{d}u \\ &amp;= \dfrac{\pi^2}{16nh}f_Y(y) \int_{-1}^1 \dfrac{1}{2} \left[\cos\left(2 \dfrac{\pi}{2} u\right) + 1\right] \text{d}u \tag{using $\cos(2\theta) = 2 \cos^2(\theta) - 1$}\\ &amp;= \dfrac{\pi^2}{32nh}f_Y(y) \int_{-1}^1 [\cos(\pi u) + 1] \text{d}u = \dfrac{\pi^2}{32nh}f_Y(y) \left[\dfrac{1}{\pi}\sin(\pi u) + u\right]_{-1}^1\\ &amp;= \dfrac{\pi^2}{32nh}f_Y(y) \left[\left(\dfrac{1}{\pi} \times 0 + 1\right) - \left(\dfrac{1}{\pi} \times 0 - 1\right)\right] = \dfrac{\pi^2}{32nh}f_Y(y) \times 2 = \dfrac{\pi^2}{16nh}f_Y(y).\end{align*}\]</span></p>
</details>
<hr />
</div>
<div id="question-9" class="section level2 hasAnchor">
<h2>Question 9<a href="kernel-density-estimation.html#question-9" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Consider a kernel density estimate, <span class="math inline">\(\widehat f_h(y)\)</span>, for an iid random sample <span class="math inline">\(Y_1, \ldots, Y_n\)</span> from the Exp(3) distribution, i.e. with pdf <span class="math display">\[f_Y(y) = \left\{\begin{array}{ll} 3 \exp(-3 y) &amp; \text{for}~y &gt; 0, \\ 0 &amp; \text{otherwise}.\end{array}\right.\]</span></p>
<ol style="list-style-type: lower-alpha">
<li>Find an approximate expression for the bias of <span class="math inline">\(\widehat f_h(y)\)</span>, based on a Taylor series expansion, if a kernel function <span class="math inline">\(w(u)\)</span> with variance <span class="math inline">\(\sigma_w^2\)</span> is used with bandwidth <span class="math inline">\(h\)</span>.</li>
</ol>
<hr />
<details>
<summary>
<strong>Solution</strong>
</summary>
<p>For <span class="math inline">\(y &gt; 0\)</span>, <span class="math inline">\(f_Y&#39;(y) = -9 \exp(-3 y)\)</span> and <span class="math inline">\(f_Y&#39;&#39;(y) = 27 \exp(-3 y)\)</span>. The approximate bias, based on a Taylor series expansion, is therefore <span class="math display">\[\text{E}[\widehat f_h(y)]  - f_Y(y) \simeq \dfrac{h^2\sigma_w^2}{2}f_Y&#39;&#39;(y) = \dfrac{h^2 \sigma_w^2}{2} 27 \exp(-3y) = \dfrac{27 h^2 \sigma_w^2}{2} \exp(-3y)\]</span> for <span class="math inline">\(y &gt; 0\)</span> and 0 otherwise.</p>
</details>
<hr />
<ol start="2" style="list-style-type: lower-alpha">
<li>Show that for the rectangular kernel the variance of <span class="math inline">\(\widehat f_h(y)\)</span> is <span class="math inline">\(3\exp(-3y) / (2nh)\)</span> for <span class="math inline">\(y &gt; 0\)</span> and zero otherwise.</li>
</ol>
<hr />
<details>
<summary>
<strong>Solution</strong>
</summary>
<p>Based on a Taylor series expansion, the approximate variance of <span class="math inline">\(\widehat f_h(y)\)</span> is <span class="math display">\[\begin{align*} \text{Var}[\widehat f_h(y)] &amp;\simeq \dfrac{f_Y(y)}{nh} \int w^2(u) \text{d}u = \dfrac{f_Y(y)}{nh} \int_{-1}^1 \left(\dfrac{1}{2}\right)^2 \text{d}u = \dfrac{f_Y(y)}{nh} \int_{-1}^1 \dfrac{1}{4} \text{d}u\\ &amp;= \dfrac{f_Y(y)}{nh}\left[\dfrac{u}{4}\right]_{-1}^1 = \dfrac{f_Y(y)}{nh}\left[\dfrac{1}{4} - \dfrac{-1}{4}\right] = \dfrac{f_Y(y)}{2nh}.\end{align*}\]</span> Substituting in <span class="math inline">\(f_Y(y)\)</span> gives <span class="math display">\[\text{Var}[\widehat{f}_h(y)] = \left\{\begin{array}{ll} \dfrac{3 \exp(-3 y)}{2nh} &amp; \text{for}~y &gt; 0, \\ 0 &amp; \text{otherwise}.\end{array}\right.\]</span></p>
</details>
<hr />
<ol start="3" style="list-style-type: lower-alpha">
<li>Use your answers to parts (a) and (b) to give the approximate mean integrated squared error (MISE) of <span class="math inline">\(\widehat f_h(y)\)</span>.</li>
</ol>
<hr />
<details>
<summary>
<strong>Solution</strong>
</summary>
<p>Based on a Taylor series expansion, the approximate MISE of <span class="math inline">\(\widehat f_h(y)\)</span> is <span class="math display">\[\begin{align*} \text{MISE}[\widehat f_h] &amp;\simeq \dfrac{h^4 \sigma_w^4}{4} \int f&#39;&#39;_Y(y)^2 dy + \dfrac{1}{nh} \int w^2(u) du\\ &amp;= \dfrac{h^4 \sigma_w^4}{4} \int_0^\infty \left[27\exp(-3y)\right]^2 \text{d}y + \dfrac{1}{2nh} \tag{using part (a)}\\ &amp;= \dfrac{h^4 \sigma_w^4}{4} \int_0^\infty 729 \exp(-6y) \text{d}y + \dfrac{1}{2nh}\\ &amp;= \dfrac{729 h^4 \sigma_w^4}{4} \left[-\dfrac{1}{6} \exp(-6y)\right]_0^\infty + \dfrac{1}{2nh}\\ &amp;= \dfrac{729 h^4 \sigma_w^4}{24} \left[0 - (-1)\right] + \dfrac{1}{2nh} = \dfrac{729 h^4 \sigma_w^4}{24} + \dfrac{1}{2nh}.\end{align*}\]</span> We now need to find <span class="math inline">\(\sigma_w^2\)</span>, which, given the kernel function has zero mean, means we need to find <span class="math inline">\(\text{E}(U^2)\)</span>, where random variable <span class="math inline">\(U \sim\)</span> Unif(-1, 1). So, <span class="math display">\[E(U^2) = \int_{-1}^1 u^2 \dfrac{1}{2} \text{d} u = \left[\dfrac{u^3}{6}\right]_{-1}^1  = \dfrac{1}{6} - \dfrac{-1}{6} = \dfrac{1}{3}.\]</span> Hence <span class="math inline">\(\sigma_w^2 = 1/3\)</span>. Substituting that back in we get <span class="math display">\[\text{MISE}[\widehat f_h] \simeq \dfrac{729 h^4}{72} + \dfrac{1}{2nh} = \dfrac{81 h^4}{8} + \dfrac{1}{2nh}.\]</span></p>
</details>
<hr />
<ol start="4" style="list-style-type: lower-alpha">
<li>Use your answers to parts (a)–(c) to give an expression in terms of <span class="math inline">\(n\)</span> for <span class="math inline">\(h_{\text{opt}}\)</span>, the bandwidth that minimises <span class="math inline">\(\text{MISE}[\widehat f_h]\)</span>.</li>
</ol>
<hr />
<details>
<summary>
<strong>Solution</strong>
</summary>
<p>If we differentiate the expression for <span class="math inline">\(\text{MISE}[\widehat f_h]\)</span> from part (c) w.r.t. <span class="math inline">\(h\)</span> we get
<span class="math display">\[
\dfrac{\partial \text{MISE}[\widehat f_h]}{\partial h} = \dfrac{81 h^3}{2} - \dfrac{1}{2nh^2}
\]</span>
and setting this to zero gives that <span class="math inline">\(h_{\text{opt}}\)</span> satisfies <span class="math inline">\(81 h_{\text{opt}}^3 = n^{-1} h_{\text{opt}}^{-2}\)</span> so that <span class="math inline">\(81 h_{\text{opt}}^5 = n^{-1}\)</span>, i.e. <span class="math inline">\(h_{\text{opt}} = (81n)^{-1/5}\)</span>. The second derivative of <span class="math inline">\(\text{MISE}[\widehat f_h]\)</span> w.r.t. <span class="math inline">\(h\)</span> is
<span class="math display">\[
\dfrac{\partial^2 \text{MISE}[\widehat f_h]}{\partial h^2} = \dfrac{243 h^2}{2} + \dfrac{1}{nh^3}
\]</span>
which is greater than zero for all <span class="math inline">\(h &gt; 0\)</span>. Hence <span class="math inline">\(h_{\text{opt}}\)</span> is at a minimum.</p>
</details>
<hr />
</div>
<div id="question-10" class="section level2 hasAnchor">
<h2>Question 10<a href="kernel-density-estimation.html#question-10" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Consider a kernel density estimate, <span class="math inline">\(\widehat f_h(y)\)</span>, of an iid Unif<span class="math inline">\((a, b)\)</span> random sample <span class="math inline">\(Y_1, \ldots, Y_n\)</span> based on a kernel function <span class="math inline">\(w(u)\)</span> and bandwidth <span class="math inline">\(h\)</span>. Show that the mean integrated squared error, based on a Taylor series expansion, is approximately <span class="math inline">\(\frac{1}{nh} \int_{-\infty}^\infty w^2(u) \text{d}u.\)</span></p>
<hr />
<details>
<summary>
<strong>Solution</strong>
</summary>
<p>The approximate mean integrated squared error (MISE) is <span class="math display">\[MISE[\widehat f_h] \simeq \dfrac{h^4 \sigma_w^2}{4} \int_a^b f&#39;&#39;_Y(y) \text{d}y + \dfrac{1}{nh} \int_{-\infty}^\infty w^2(u)\text{d}u.\]</span> For the Unif<span class="math inline">\((a, b)\)</span> distribution, the pdf is <span class="math inline">\(f_Y(y) = 1/(b - a)\)</span> for <span class="math inline">\(y \in [a, b]\)</span> and is zero otherwise. As <span class="math inline">\(f&#39;_Y(y) = f&#39;&#39;_Y(y) = 0~\forall~y\)</span>, <span class="math inline">\(MISE[\widehat f_h]\)</span> reduces to <span class="math display">\[MISE[\widehat f_h] \simeq \dfrac{1}{nh} \int_{-\infty}^\infty w^2(u)\text{d}u.\]</span></p>
</details>
<hr />
</div>
<div id="question-11" class="section level2 hasAnchor">
<h2>Question 11<a href="kernel-density-estimation.html#question-11" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>(5.4.7) Consider a kernel density estimate of the Exeter Airport wind speeds based on a normal kernel function. Given that these are a sample of size <span class="math inline">\(n = 365\)</span> with sample variance <span class="math inline">\(s^2 = 12.356\)</span> and sample interquartile range <span class="math inline">\(IQR = 4.458\)</span>, find the optimal bandwidths that minimise the mean integrated squared error if the pdf of wind speeds is assumed normal and with Silverman’s rule of thumb.</p>
<hr />
<details>
<summary>
<strong>Solution</strong>
</summary>
<p>If the pdf of the wind speeds is assumed normal, then <span class="math inline">\(h_{\text{opt}}^N = 1.06 \sigma n^{-1/5}\)</span> and substituting <span class="math inline">\(s\)</span> for <span class="math inline">\(\sigma\)</span> gives <span class="math inline">\(h_{\text{opt}}^N \simeq 1.145\)</span>. For Silverman’s rule of thumb we have <span class="math inline">\(h_{\text{opt}}^S = 0.9 \min\{s, IQR/1.34\}n^{-1/5}\)</span> and substituting <span class="math inline">\(s\)</span> and <span class="math inline">\(IQR\)</span> gives <span class="math inline">\(h_{\text{opt}}^S \simeq 0.9 \min\{3.515, 4.458/1.34\} n^{-1/5} \simeq 0.9 \times 3.327 \times n^{-1/5} = 0.920.\)</span></p>
</details>
<hr />
</div>
<div id="question-12" class="section level2 hasAnchor">
<h2>Question 12<a href="kernel-density-estimation.html#question-12" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>For the Old Faithful geyser eruption times use the following <code>R</code> output</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="kernel-density-estimation.html#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(faithful)</span></code></pre></div>
<pre><code>## [1] 272</code></pre>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="kernel-density-estimation.html#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sd</span>(faithful<span class="sc">$</span>eruptions)</span></code></pre></div>
<pre><code>## [1] 1.141371</code></pre>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="kernel-density-estimation.html#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">IQR</span>(faithful<span class="sc">$</span>eruptions)</span></code></pre></div>
<pre><code>## [1] 2.2915</code></pre>
<p>to confirm the optimal bandwidths <span class="math inline">\(h_{\text{opt}}^N = 0.394\)</span> and <span class="math inline">\(h_{\text{opt}}^S = 0.335\)</span> for kernel density estimates based on the normal kernel function.</p>
<hr />
<details>
<summary>
<strong>Solution</strong>
</summary>
<p>We have <span class="math inline">\(n = 272\)</span> and <span class="math inline">\(s \simeq 1.141\)</span> and so <span class="math inline">\(h_{\text{opt}}^N \simeq 1.06 \times 1.141 \times 272^{-1/5} \simeq 0.394\)</span>. We also have <span class="math inline">\(IQR = 2.292\)</span> and so <span class="math inline">\(h_{\text{opt}}^S \simeq 0.9 \min\{1.141, 2.292/1.34\} n^{-1/5} \simeq 0.9 \times 1.141 \times 272^{-1/5} = 0.335.\)</span></p>
</details>
<hr />
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="estimating-cdfs-and-pdfs-and-testing-their-goodness-of-fit.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="nonparametric-tests-for-two-independent-samples.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": false,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
