<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>2 Statistical computing in R | MTH3045: Statistical Computing</title>
  <meta name="description" content="2 Statistical computing in R | MTH3045: Statistical Computing" />
  <meta name="generator" content="bookdown 0.29 and GitBook 2.6.7" />

  <meta property="og:title" content="2 Statistical computing in R | MTH3045: Statistical Computing" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="2 Statistical computing in R | MTH3045: Statistical Computing" />
  
  
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html"/>
<link rel="next" href="matrix-based-computing.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#module-outline"><i class="fa fa-check"></i><b>1.1</b> Module outline</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#lectures-practical-classes"><i class="fa fa-check"></i><b>1.2</b> Lectures / practical classes</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#office-hours"><i class="fa fa-check"></i><b>1.3</b> Office hours</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#resources"><i class="fa fa-check"></i><b>1.4</b> Resources</a></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#acknowledgements"><i class="fa fa-check"></i><b>1.5</b> Acknowledgements</a></li>
<li class="chapter" data-level="1.6" data-path="index.html"><a href="index.html#assessment"><i class="fa fa-check"></i><b>1.6</b> Assessment</a></li>
<li class="chapter" data-level="1.7" data-path="index.html"><a href="index.html#motivating-example"><i class="fa fa-check"></i><b>1.7</b> Motivating example</a></li>
<li class="chapter" data-level="1.8" data-path="index.html"><a href="index.html#exploratory-and-refresher-exercises"><i class="fa fa-check"></i><b>1.8</b> Exploratory and refresher exercises</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="ch2.html"><a href="ch2.html"><i class="fa fa-check"></i><b>2</b> Statistical computing in <code>R</code></a>
<ul>
<li class="chapter" data-level="2.1" data-path="ch2.html"><a href="ch2.html#overview"><i class="fa fa-check"></i><b>2.1</b> Overview</a></li>
<li class="chapter" data-level="2.2" data-path="ch2.html"><a href="ch2.html#mathematics-by-computer"><i class="fa fa-check"></i><b>2.2</b> Mathematics by computer</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="ch2.html"><a href="ch2.html#positional-number-systems"><i class="fa fa-check"></i><b>2.2.1</b> Positional number systems</a></li>
<li class="chapter" data-level="2.2.2" data-path="ch2.html"><a href="ch2.html#a-historical-aside-on-exact-representations-of-integers"><i class="fa fa-check"></i><b>2.2.2</b> A historical aside on exact representations of integers</a></li>
<li class="chapter" data-level="2.2.3" data-path="ch2.html"><a href="ch2.html#floating-point-representation"><i class="fa fa-check"></i><b>2.2.3</b> Floating point representation</a></li>
<li class="chapter" data-level="2.2.4" data-path="ch2.html"><a href="ch2.html#single-precision-arithmetic"><i class="fa fa-check"></i><b>2.2.4</b> Single-precision arithmetic</a></li>
<li class="chapter" data-level="2.2.5" data-path="ch2.html"><a href="ch2.html#double-precision-arithmetic"><i class="fa fa-check"></i><b>2.2.5</b> Double-precision arithmetic</a></li>
<li class="chapter" data-level="2.2.6" data-path="ch2.html"><a href="ch2.html#flops-floating-point-operations"><i class="fa fa-check"></i><b>2.2.6</b> Flops: floating point operations</a></li>
<li class="chapter" data-level="2.2.7" data-path="ch2.html"><a href="ch2.html#some-useful-terminology"><i class="fa fa-check"></i><b>2.2.7</b> Some useful terminology</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="ch2.html"><a href="ch2.html#the-history-of-r"><i class="fa fa-check"></i><b>2.3</b> The history of <code>R</code></a></li>
<li class="chapter" data-level="2.4" data-path="ch2.html"><a href="ch2.html#why-r"><i class="fa fa-check"></i><b>2.4</b> Why <code>R</code>?</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="ch2.html"><a href="ch2.html#basics"><i class="fa fa-check"></i><b>2.4.1</b> Basics</a></li>
<li class="chapter" data-level="2.4.2" data-path="ch2.html"><a href="ch2.html#data-structures"><i class="fa fa-check"></i><b>2.4.2</b> Data structures</a></li>
<li class="chapter" data-level="2.4.3" data-path="ch2.html"><a href="ch2.html#some-useful-r-functions"><i class="fa fa-check"></i><b>2.4.3</b> Some useful <code>R</code> functions</a></li>
<li class="chapter" data-level="2.4.4" data-path="ch2.html"><a href="ch2.html#control-structures"><i class="fa fa-check"></i><b>2.4.4</b> Control structures</a></li>
<li class="chapter" data-level="2.4.5" data-path="ch2.html"><a href="ch2.html#vectorisation"><i class="fa fa-check"></i><b>2.4.5</b> Vectorisation</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="ch2.html"><a href="ch2.html#good-practice"><i class="fa fa-check"></i><b>2.5</b> Good practice</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="ch2.html"><a href="ch2.html#useful-tips-to-remember-when-coding"><i class="fa fa-check"></i><b>2.5.1</b> Useful tips to remember when coding</a></li>
<li class="chapter" data-level="2.5.2" data-path="ch2.html"><a href="ch2.html#debugging"><i class="fa fa-check"></i><b>2.5.2</b> Debugging</a></li>
<li class="chapter" data-level="2.5.3" data-path="ch2.html"><a href="ch2.html#profiling-and-benchmarking"><i class="fa fa-check"></i><b>2.5.3</b> Profiling and benchmarking</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="ch2.html"><a href="ch2.html#compiled-code-with-rcpp"><i class="fa fa-check"></i><b>2.6</b> Compiled code with <code>Rcpp</code></a></li>
<li class="chapter" data-level="2.7" data-path="ch2.html"><a href="ch2.html#bibliographic-notes"><i class="fa fa-check"></i><b>2.7</b> Bibliographic notes</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="matrix-based-computing.html"><a href="matrix-based-computing.html"><i class="fa fa-check"></i><b>3</b> Matrix-based computing</a>
<ul>
<li class="chapter" data-level="3.1" data-path="matrix-based-computing.html"><a href="matrix-based-computing.html#motivation"><i class="fa fa-check"></i><b>3.1</b> Motivation</a></li>
<li class="chapter" data-level="3.2" data-path="matrix-based-computing.html"><a href="matrix-based-computing.html#definitions"><i class="fa fa-check"></i><b>3.2</b> Definitions</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="matrix-based-computing.html"><a href="matrix-based-computing.html#matrix-properties"><i class="fa fa-check"></i><b>3.2.1</b> Matrix properties</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="matrix-based-computing.html"><a href="matrix-based-computing.html#special-matrices"><i class="fa fa-check"></i><b>3.3</b> Special matrices</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="matrix-based-computing.html"><a href="matrix-based-computing.html#diagonal-band-diagonal-and-triangular-matrices"><i class="fa fa-check"></i><b>3.3.1</b> Diagonal, band-diagonal and triangular matrices</a></li>
<li class="chapter" data-level="3.3.2" data-path="matrix-based-computing.html"><a href="matrix-based-computing.html#sparse-matrices"><i class="fa fa-check"></i><b>3.3.2</b> Sparse matrices</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="matrix-based-computing.html"><a href="matrix-based-computing.html#systems-of-linear-equations"><i class="fa fa-check"></i><b>3.4</b> Systems of linear equations</a></li>
<li class="chapter" data-level="3.5" data-path="matrix-based-computing.html"><a href="matrix-based-computing.html#matrix-decompositions"><i class="fa fa-check"></i><b>3.5</b> Matrix decompositions</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="matrix-based-computing.html"><a href="matrix-based-computing.html#cholesky-decomposition"><i class="fa fa-check"></i><b>3.5.1</b> Cholesky decomposition</a></li>
<li class="chapter" data-level="3.5.2" data-path="matrix-based-computing.html"><a href="matrix-based-computing.html#eigen-decomposition"><i class="fa fa-check"></i><b>3.5.2</b> Eigen-decomposition</a></li>
<li class="chapter" data-level="3.5.3" data-path="matrix-based-computing.html"><a href="matrix-based-computing.html#singular-value-decomposition"><i class="fa fa-check"></i><b>3.5.3</b> Singular value decomposition</a></li>
<li class="chapter" data-level="3.5.4" data-path="matrix-based-computing.html"><a href="matrix-based-computing.html#qr-decomposition"><i class="fa fa-check"></i><b>3.5.4</b> QR decomposition</a></li>
<li class="chapter" data-level="3.5.5" data-path="matrix-based-computing.html"><a href="matrix-based-computing.html#computational-costs-of-matrix-decompostions"><i class="fa fa-check"></i><b>3.5.5</b> Computational costs of matrix decompostions</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="matrix-based-computing.html"><a href="matrix-based-computing.html#sherman-morrison-formula-woodbury-matrix-identity"><i class="fa fa-check"></i><b>3.6</b> Sherman-Morrison formula / Woodbury matrix identity</a>
<ul>
<li class="chapter" data-level="3.6.1" data-path="matrix-based-computing.html"><a href="matrix-based-computing.html#woodburys-formula"><i class="fa fa-check"></i><b>3.6.1</b> Woodbury’s formula</a></li>
<li class="chapter" data-level="3.6.2" data-path="matrix-based-computing.html"><a href="matrix-based-computing.html#sherman-morrison-woodbury-formula"><i class="fa fa-check"></i><b>3.6.2</b> Sherman-Morrison-Woodbury formula</a></li>
<li class="chapter" data-level="3.6.3" data-path="matrix-based-computing.html"><a href="matrix-based-computing.html#sherman-morrison-formula"><i class="fa fa-check"></i><b>3.6.3</b> Sherman-Morrison formula</a></li>
</ul></li>
<li class="chapter" data-level="3.7" data-path="matrix-based-computing.html"><a href="matrix-based-computing.html#bibliographic-notes-1"><i class="fa fa-check"></i><b>3.7</b> Bibliographic notes</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="numerical-calculus.html"><a href="numerical-calculus.html"><i class="fa fa-check"></i><b>4</b> Numerical Calculus</a>
<ul>
<li class="chapter" data-level="4.1" data-path="numerical-calculus.html"><a href="numerical-calculus.html#motivation-1"><i class="fa fa-check"></i><b>4.1</b> Motivation</a></li>
<li class="chapter" data-level="4.2" data-path="numerical-calculus.html"><a href="numerical-calculus.html#numerical-differentiation"><i class="fa fa-check"></i><b>4.2</b> Numerical Differentiation</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="numerical-calculus.html"><a href="numerical-calculus.html#differentiation-definitions"><i class="fa fa-check"></i><b>4.2.1</b> Differentiation definitions</a></li>
<li class="chapter" data-level="4.2.2" data-path="numerical-calculus.html"><a href="numerical-calculus.html#differentiation-rules"><i class="fa fa-check"></i><b>4.2.2</b> Differentiation rules</a></li>
<li class="chapter" data-level="4.2.3" data-path="numerical-calculus.html"><a href="numerical-calculus.html#finite-differencing"><i class="fa fa-check"></i><b>4.2.3</b> Finite-differencing</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="numerical-calculus.html"><a href="numerical-calculus.html#quadrature"><i class="fa fa-check"></i><b>4.3</b> Quadrature</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="numerical-calculus.html"><a href="numerical-calculus.html#midpoint-rule"><i class="fa fa-check"></i><b>4.3.1</b> Midpoint rule</a></li>
<li class="chapter" data-level="4.3.2" data-path="numerical-calculus.html"><a href="numerical-calculus.html#simpsons-rule"><i class="fa fa-check"></i><b>4.3.2</b> Simpson’s rule</a></li>
<li class="chapter" data-level="4.3.3" data-path="numerical-calculus.html"><a href="numerical-calculus.html#gaussian-quadrature"><i class="fa fa-check"></i><b>4.3.3</b> Gaussian quadrature</a></li>
<li class="chapter" data-level="4.3.4" data-path="numerical-calculus.html"><a href="numerical-calculus.html#one-dimensional-numerical-integration-in-r"><i class="fa fa-check"></i><b>4.3.4</b> One-dimensional numerical integration in <code>R</code></a></li>
<li class="chapter" data-level="4.3.5" data-path="numerical-calculus.html"><a href="numerical-calculus.html#multi-dimensional-quadrature"><i class="fa fa-check"></i><b>4.3.5</b> Multi-dimensional quadrature</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="numerical-calculus.html"><a href="numerical-calculus.html#laplaces-method"><i class="fa fa-check"></i><b>4.4</b> Laplace’s method</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="numerical-calculus.html"><a href="numerical-calculus.html#an-aside-on-taylor-series-in-one-dimension"><i class="fa fa-check"></i><b>4.4.1</b> An aside on Taylor series in one dimension</a></li>
<li class="chapter" data-level="4.4.2" data-path="numerical-calculus.html"><a href="numerical-calculus.html#definition-1"><i class="fa fa-check"></i><b>4.4.2</b> Definition</a></li>
<li class="chapter" data-level="4.4.3" data-path="numerical-calculus.html"><a href="numerical-calculus.html#laplaces-method-for-multiple-dimensions"><i class="fa fa-check"></i><b>4.4.3</b> Laplace’s method for multiple dimensions</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="numerical-calculus.html"><a href="numerical-calculus.html#monte-carlo-integration"><i class="fa fa-check"></i><b>4.5</b> Monte Carlo integration</a></li>
<li class="chapter" data-level="4.6" data-path="numerical-calculus.html"><a href="numerical-calculus.html#bibliographic-notes-2"><i class="fa fa-check"></i><b>4.6</b> Bibliographic notes</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="optimisation.html"><a href="optimisation.html"><i class="fa fa-check"></i><b>5</b> Optimisation</a>
<ul>
<li class="chapter" data-level="5.1" data-path="optimisation.html"><a href="optimisation.html#root-finding"><i class="fa fa-check"></i><b>5.1</b> Root finding</a></li>
<li class="chapter" data-level="5.2" data-path="optimisation.html"><a href="optimisation.html#one-dimensional-optimisation-in-r"><i class="fa fa-check"></i><b>5.2</b> One-dimensional optimisation in <code>R</code></a></li>
<li class="chapter" data-level="5.3" data-path="optimisation.html"><a href="optimisation.html#newtons-method-in-one-dimension"><i class="fa fa-check"></i><b>5.3</b> Newton’s method in one-dimension</a></li>
<li class="chapter" data-level="5.4" data-path="optimisation.html"><a href="optimisation.html#newtons-multi-dimensional-method"><i class="fa fa-check"></i><b>5.4</b> Newton’s multi-dimensional method</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="optimisation.html"><a href="optimisation.html#taylors-theorem-multivariate"><i class="fa fa-check"></i><b>5.4.1</b> Taylor’s theorem (multivariate)</a></li>
<li class="chapter" data-level="5.4.2" data-path="optimisation.html"><a href="optimisation.html#newtons-method-in-r"><i class="fa fa-check"></i><b>5.4.2</b> Newton’s method in <code>R</code></a></li>
<li class="chapter" data-level="5.4.3" data-path="optimisation.html"><a href="optimisation.html#gradient-descent"><i class="fa fa-check"></i><b>5.4.3</b> Gradient descent</a></li>
<li class="chapter" data-level="5.4.4" data-path="optimisation.html"><a href="optimisation.html#line-search"><i class="fa fa-check"></i><b>5.4.4</b> Line search</a></li>
<li class="chapter" data-level="5.4.5" data-path="optimisation.html"><a href="optimisation.html#quasi-newton-methods"><i class="fa fa-check"></i><b>5.4.5</b> Quasi-Newton methods</a></li>
<li class="chapter" data-level="5.4.6" data-path="optimisation.html"><a href="optimisation.html#quasi-newton-methods-in-r"><i class="fa fa-check"></i><b>5.4.6</b> Quasi-Newton methods in <code>R</code></a></li>
<li class="chapter" data-level="5.4.7" data-path="optimisation.html"><a href="optimisation.html#sec:nelder"><i class="fa fa-check"></i><b>5.4.7</b> Nelder-Mead polytope method</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="optimisation.html"><a href="optimisation.html#global-optimisation"><i class="fa fa-check"></i><b>5.5</b> Global optimisation</a>
<ul>
<li class="chapter" data-level="5.5.1" data-path="optimisation.html"><a href="optimisation.html#stochastic-optimisation"><i class="fa fa-check"></i><b>5.5.1</b> Stochastic optimisation</a></li>
<li class="chapter" data-level="5.5.2" data-path="optimisation.html"><a href="optimisation.html#simulated-annealing"><i class="fa fa-check"></i><b>5.5.2</b> Simulated annealing</a></li>
<li class="chapter" data-level="5.5.3" data-path="optimisation.html"><a href="optimisation.html#simulated-annealing-in-r"><i class="fa fa-check"></i><b>5.5.3</b> Simulated annealing in <code>R</code></a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="optimisation.html"><a href="optimisation.html#bibliographic-notes-3"><i class="fa fa-check"></i><b>5.6</b> Bibliographic notes</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">MTH3045: Statistical Computing</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="ch2" class="section level1 hasAnchor" number="2">
<h1><span class="header-section-number">2</span> Statistical computing in <code>R</code><a href="ch2.html#ch2" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="overview" class="section level2 hasAnchor" number="2.1">
<h2><span class="header-section-number">2.1</span> Overview<a href="ch2.html#overview" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In MTHM3045 we’ll be using the programming language <code>R</code> for computation. Note that <code>RStudio</code> is an Integrated Development Environment (IDE) for <code>R</code>: it simplifies working with scripts, <code>R</code> objects, plotting and issuing commands by putting them all in one place. In MTH3045 we’ll typically be interested in programming, so will just refer to <code>R</code>, but you may want to think of this as code that’s run in <code>RStudio</code>.</p>
</div>
<div id="mathematics-by-computer" class="section level2 hasAnchor" number="2.2">
<h2><span class="header-section-number">2.2</span> Mathematics by computer<a href="ch2.html#mathematics-by-computer" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In statistical computing, we can usually rely on our computer software to take care of most things in the background. Nonetheless, it’s useful to know the basics of how computers perform calculations, as, if our code isn’t doing what we’d like, or what we’d expect, then such knowledge can help us diagnose any problems.</p>
<p>Put simply, if we issue</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="ch2.html#cb10-1" tabindex="-1"></a><span class="sc">&gt;</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">2</span></span></code></pre></div>
<pre><code>## [1] 3</code></pre>
<p>in <code>R</code>, how does it get to the answer of 3?</p>
<div id="positional-number-systems" class="section level3 hasAnchor" number="2.2.1">
<h3><span class="header-section-number">2.2.1</span> Positional number systems<a href="ch2.html#positional-number-systems" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Any positive number, <span class="math inline">\(z\)</span>, can be represented as a base-<span class="math inline">\(B\)</span> number with the digits <span class="math inline">\(\{0, 1, \ldots, B-1\}\)</span> in the form <span class="math display">\[z = a_kB^k + \ldots + a_2B^2 + a_1B + a_0 + a_{-1}B^{-1} + a_{-2}B^{-2} + \ldots \]</span> for integer coefficients <span class="math inline">\(a_j\)</span> in the set <span class="math inline">\(\{0, 1, \ldots, B-1\}\)</span>. We can write this more tidily as <span class="math display">\[(a_k \ldots a_2 a_1 a_0. a_{-1} a_{-2} \ldots)_B.\]</span> The ‘dot’ in this representation is called the <em>radix point</em>, or the decimal point, in the special case of base 10, which is usually referred to simply as ‘decimal’.</p>
<p>In a <em>fixed point</em> number system, the radix point is always placed in the same place, i.e. after <span class="math inline">\(a_0\)</span>, the coefficient of <span class="math inline">\(B^0 = 1\)</span>. So when we write <span class="math inline">\(\pi\)</span> as 3.14159… in decimal form, we have the decimal point after the 3, which is the coefficient of <span class="math inline">\(10^0 = 1\)</span>. Fixed point number systems are easy for humans to interpret.</p>
</div>
<div id="a-historical-aside-on-exact-representations-of-integers" class="section level3 hasAnchor" number="2.2.2">
<h3><span class="header-section-number">2.2.2</span> A historical aside on exact representations of integers<a href="ch2.html#a-historical-aside-on-exact-representations-of-integers" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Humans now usually use base 10 for mathematics, and computers work in base two. However, humans used to primarily use base 60, known as sexagesimal, for mathematics. The sexagesimal system can be traced back to the Sumerians back in 3000BC. The many factors of 60, e.g., 1, 2, 3, 4, 5, 6, …, 30, 60, were one of its selling points, and it’s still used for some formats of angles and coordinates, and of course time! The decimal number system is attributed to Archimedes (c. 287–212 BCE).</p>
</div>
<div id="floating-point-representation" class="section level3 hasAnchor" number="2.2.3">
<h3><span class="header-section-number">2.2.3</span> Floating point representation<a href="ch2.html#floating-point-representation" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In a <em>floating point</em> number system, the radix point is free to move. Computers use such number systems. Scientific notation, e.g. Avagadro’s number <span class="math display">\[N = 6.023 \times 10^{23}\]</span> is an example of such a system. More generally, we can write any <em>positive</em> number in the form <span class="math display">\[M \times B^{E - e},\]</span> where <span class="math inline">\(M\)</span> is the <em>mantissa</em>, <span class="math inline">\(E\)</span> is the <em>exponent</em>, and <span class="math inline">\(e\)</span> is the <em>excess</em>, and even more generally, we can write <em>any</em> number in the form <span class="math display">\[S \times M \times B^{E - e}, \]</span> where <span class="math inline">\(S\)</span> is its <em>sign</em>. We may think of <span class="math inline">\(S\)</span> as from the set <span class="math inline">\(\{+, -\}\)</span>. Hence, for a given base, we can represent any number with the triple <span class="math inline">\((S, E, e, M)\)</span>. In base 10 Avogadro’s number can be written <span class="math inline">\(N = (+, 24, 0, 0.6023)\)</span> or <span class="math inline">\(N = (+, 23, 0, 6.023)\)</span>. The latter is classed as <em>normalised</em> because its leading term is non-zero.</p>
</div>
<div id="single-precision-arithmetic" class="section level3 hasAnchor" number="2.2.4">
<h3><span class="header-section-number">2.2.4</span> Single-precision arithmetic<a href="ch2.html#single-precision-arithmetic" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Computers work in base <span class="math inline">\(B = 2\)</span>, or <em>binary</em>, and usually consider the mantissa to be of the form <span class="math inline">\(M = 1 + F\)</span>, where <span class="math inline">\(F \in [0, 1)\)</span> is the <em>fraction</em>, giving <span class="math display">\[S \times (1 + F) \times 2^{E - e}\]</span> and hence using a normalised representation. Computers use a limited number of <em>bits</em> to store numbers. As a result any number is only stored approximately. Computers vary in how they store different types of number. A commonly-used standard is <a href="https://en.wikipedia.org/wiki/IEEE_754">IEEE 754</a>.</p>
<p>Let’s first consider <em>single-precision</em> arithmetic, which uses 32 bits, <span class="math inline">\(b_1, \ldots, b_{32}\)</span>, say, to store numbers. Under the IEEE 754 standard, the order of bits is arbitrary. What each does is defined, so that</p>
<ul>
<li>1 bit, <span class="math inline">\(b_1\)</span> say, gives the sign, <span class="math inline">\(S = (-1)^{b_1}\)</span>,</li>
<li>8 bits, <span class="math inline">\(b_2, \ldots, b_9\)</span>, give the exponent, <span class="math inline">\(E = \sum_{i = 1}^8 b_{i + 1} 2^{8 - i}\)</span>,</li>
<li>23 bits, <span class="math inline">\(b_{10}, \ldots, b_{32}\)</span>, give the fraction, <span class="math inline">\(F = \sum_{i = 1}^{23} b_{i + 9} 2^{-i}\)</span>,</li>
</ul>
<p>with <span class="math inline">\(e = 127\)</span> fixed.</p>
<div class="example">
<p><span id="exm:pi32" class="example"><strong>Example 2.1  </strong></span>Consider the single-precision representation</p>
<p><span class="math display">\[0~10000000~10010010000111111011011\]</span></p>
<p>and use <code>R</code> to find the number in decimal form to 20 decimal places.</p>
<p>We’ll start with a function <code>bit2decimal()</code> for converting a bit string into a decimal. Producing such a function is beyond the scope of MTH3045, but some aspects of the function may help you with other parts of the module. The comments should give an idea of what each line of <code>bit2decimal()</code> does. Note that <code>bit2decimal()</code> has arguments <code>x</code>, the bit string we want to convert, <code>e</code> for the excess <span class="math inline">\(e\)</span>, and <code>dp</code>, which specifies the number of decimal places we want it to return the decimal number to. These are repeated at the start of the function, which is often good practice, especially when sharing code.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="ch2.html#cb12-1" tabindex="-1"></a><span class="sc">&gt;</span> bit2decimal <span class="ot">&lt;-</span> <span class="cf">function</span>(x, e, <span class="at">dp =</span> <span class="dv">20</span>) {</span>
<span id="cb12-2"><a href="ch2.html#cb12-2" tabindex="-1"></a><span class="sc">+</span> <span class="co"># function to convert bits to decimal form</span></span>
<span id="cb12-3"><a href="ch2.html#cb12-3" tabindex="-1"></a><span class="sc">+</span> <span class="co"># x: the bits as a character string, with appropriate spaces</span></span>
<span id="cb12-4"><a href="ch2.html#cb12-4" tabindex="-1"></a><span class="sc">+</span> <span class="co"># e: the excess</span></span>
<span id="cb12-5"><a href="ch2.html#cb12-5" tabindex="-1"></a><span class="sc">+</span> <span class="co"># dp: the decimal places to report the answer to</span></span>
<span id="cb12-6"><a href="ch2.html#cb12-6" tabindex="-1"></a><span class="sc">+</span> bl <span class="ot">&lt;-</span> <span class="fu">strsplit</span>(x, <span class="st">&#39; &#39;</span>)[[<span class="dv">1</span>]] <span class="co"># split x into S, E and F components by spaces</span></span>
<span id="cb12-7"><a href="ch2.html#cb12-7" tabindex="-1"></a><span class="sc">+</span> <span class="co"># and then into a list of three character vectors, each element one bit</span></span>
<span id="cb12-8"><a href="ch2.html#cb12-8" tabindex="-1"></a><span class="sc">+</span> bl <span class="ot">&lt;-</span> <span class="fu">lapply</span>(bl, <span class="cf">function</span>(z) <span class="fu">as.integer</span>(<span class="fu">strsplit</span>(z, <span class="st">&#39;&#39;</span>)[[<span class="dv">1</span>]]))</span>
<span id="cb12-9"><a href="ch2.html#cb12-9" tabindex="-1"></a><span class="sc">+</span> <span class="fu">names</span>(bl) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;S&#39;</span>, <span class="st">&#39;E&#39;</span>, <span class="st">&#39;F&#39;</span>) <span class="co"># give names, to simplify next few lines</span></span>
<span id="cb12-10"><a href="ch2.html#cb12-10" tabindex="-1"></a><span class="sc">+</span> S <span class="ot">&lt;-</span> (<span class="sc">-</span><span class="dv">1</span>)<span class="sc">^</span>bl<span class="sc">$</span>S <span class="co"># calculate sign, S</span></span>
<span id="cb12-11"><a href="ch2.html#cb12-11" tabindex="-1"></a><span class="sc">+</span> E <span class="ot">&lt;-</span> <span class="fu">sum</span>(bl<span class="sc">$</span>E <span class="sc">*</span> <span class="dv">2</span><span class="sc">^</span><span class="fu">c</span>((<span class="fu">length</span>(bl<span class="sc">$</span>E) <span class="sc">-</span> <span class="dv">1</span>)<span class="sc">:</span><span class="dv">0</span>)) <span class="co"># ditto for exponent, E</span></span>
<span id="cb12-12"><a href="ch2.html#cb12-12" tabindex="-1"></a><span class="sc">+</span> F <span class="ot">&lt;-</span> <span class="fu">sum</span>(bl<span class="sc">$</span>F <span class="sc">*</span> <span class="dv">2</span><span class="sc">^</span>(<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(bl<span class="sc">$</span>F)))) <span class="co"># and ditto to fraction, F</span></span>
<span id="cb12-13"><a href="ch2.html#cb12-13" tabindex="-1"></a><span class="sc">+</span> z <span class="ot">&lt;-</span> S <span class="sc">*</span> <span class="dv">2</span><span class="sc">^</span>(E <span class="sc">-</span> e) <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> F) <span class="co"># calculate z</span></span>
<span id="cb12-14"><a href="ch2.html#cb12-14" tabindex="-1"></a><span class="sc">+</span> out <span class="ot">&lt;-</span> <span class="fu">format</span>(z, <span class="at">nsmall =</span> dp) <span class="co"># use format() for specific dp</span></span>
<span id="cb12-15"><a href="ch2.html#cb12-15" tabindex="-1"></a><span class="sc">+</span> <span class="co"># add (S, E, F) as attributes, for reference</span></span>
<span id="cb12-16"><a href="ch2.html#cb12-16" tabindex="-1"></a><span class="sc">+</span> <span class="fu">attr</span>(out, <span class="st">&#39;(S,E,F)&#39;</span>) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">S =</span> S, <span class="at">E =</span> E, <span class="at">F =</span> F) </span>
<span id="cb12-17"><a href="ch2.html#cb12-17" tabindex="-1"></a><span class="sc">+</span> out</span>
<span id="cb12-18"><a href="ch2.html#cb12-18" tabindex="-1"></a><span class="sc">+</span> }</span></code></pre></div>
<p>Then we’ll input the numbers in binary form, and call <code>bit2decimal()</code>.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="ch2.html#cb13-1" tabindex="-1"></a><span class="sc">&gt;</span> b0 <span class="ot">&lt;-</span> <span class="st">&#39;0 10000000 10010010000111111011011&#39;</span></span>
<span id="cb13-2"><a href="ch2.html#cb13-2" tabindex="-1"></a><span class="sc">&gt;</span> sing_prec <span class="ot">&lt;-</span> <span class="fu">bit2decimal</span>(b0, <span class="dv">127</span>)</span>
<span id="cb13-3"><a href="ch2.html#cb13-3" tabindex="-1"></a><span class="sc">&gt;</span> sing_prec</span></code></pre></div>
<pre><code>## [1] &quot;3.14159274101257324219&quot;
## attr(,&quot;(S,E,F)&quot;)
##           S           E           F 
##   1.0000000 128.0000000   0.5707964</code></pre>
<p>That’s right: it’s the single-precision representation of <span class="math inline">\(\pi\)</span>.</p>
<p>Note that for MTH3045, you’re not expected to repeat a similar calculation. The example is merely designed to show how the given single-precision representation can be converted to a number in conventional format, as shown by <code>R</code>. Also note that the function <code>format()</code> guarantees printing a number to <code>nsmall</code> decimal places.</p>
</div>
</div>
<div id="double-precision-arithmetic" class="section level3 hasAnchor" number="2.2.5">
<h3><span class="header-section-number">2.2.5</span> Double-precision arithmetic<a href="ch2.html#double-precision-arithmetic" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><code>R</code> usually uses <em>double-precision</em> arithmetic, which uses 64 bits to store numbers.</p>
<ul>
<li>1 bit, <span class="math inline">\(b_1\)</span> say, for the sign, <span class="math inline">\(S = (-1)^{b_1}\)</span>.</li>
<li>11 bits, <span class="math inline">\(b_2, \ldots, b_{12}\)</span>, for the exponent, <span class="math inline">\(E = \sum_{i = 1}^{11} b_{i + 1} 2^{11 - i}\)</span>.</li>
<li>52 bits, <span class="math inline">\(b_{13}, \ldots, b_{64}\)</span>, for the fraction, <span class="math inline">\(F = \sum_{i = 1}^{52} b_{i + 9} 2^{-i}\)</span>.</li>
</ul>
<p>For double-precision arithmetic <span class="math inline">\(e = 1023\)</span>. Using twice as many bits essentially brings twice the precision; hence double- instead of single-precision.</p>
<div class="example">
<p><span id="exm:pi64" class="example"><strong>Example 2.2  </strong></span>Now consider the double-precision representation</p>
<p><span class="math display">\[0~10000000000~1001001000011111101101010100010001000010110100011000\]</span></p>
<p>and use <code>R</code> to find the number in decimal form to 20 decimal places.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="ch2.html#cb15-1" tabindex="-1"></a><span class="sc">&gt;</span> b0 <span class="ot">&lt;-</span> <span class="st">&#39;0 10000000000 1001001000011111101101010100010001000010110100011000&#39;</span></span>
<span id="cb15-2"><a href="ch2.html#cb15-2" tabindex="-1"></a><span class="sc">&gt;</span> doub_prec <span class="ot">&lt;-</span> <span class="fu">bit2decimal</span>(b0, <span class="dv">1023</span>)</span>
<span id="cb15-3"><a href="ch2.html#cb15-3" tabindex="-1"></a><span class="sc">&gt;</span> doub_prec</span></code></pre></div>
<pre><code>## [1] &quot;3.14159265358979311600&quot;
## attr(,&quot;(S,E,F)&quot;)
##            S            E            F 
##    1.0000000 1024.0000000    0.5707963</code></pre>
<p>Rather repetitively, it’s the double-precision representation of <span class="math inline">\(\pi\)</span>.</p>
</div>
<p>The constant <span class="math inline">\(\pi\)</span> is built in to <code>R</code> as <code>pi</code>. We can compare our single- and double-precision approximations to that built in</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="ch2.html#cb17-1" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">format</span>(pi <span class="sc">-</span> <span class="fu">as.double</span>(sing_prec), <span class="at">nsmall =</span> <span class="dv">20</span>)</span></code></pre></div>
<pre><code>## [1] &quot;-8.742278e-08&quot;</code></pre>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="ch2.html#cb19-1" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">format</span>(pi <span class="sc">-</span> <span class="fu">as.double</span>(doub_prec), <span class="at">nsmall =</span> <span class="dv">20</span>)</span></code></pre></div>
<pre><code>## [1] &quot;0.00000000000000000000&quot;</code></pre>
<p>and we see that our double-precision approximation is exactly the same as that built in, whereas the single-precision version differs by <span class="math inline">\(10^{-8}\)</span> in order of magnitude. Note that our function <code>bit2decimal()</code> generated a character string (which let us ensure it printed a specific number of decimal places), so we use <code>as.double()</code> to convert its output to a double-precision number, which allows direct comparison with <code>pi</code>.</p>
<div class="remark">
<p><span id="unlabeled-div-1" class="remark"><em>Remark</em>. </span>We can overwrite <code>R</code>’s constants.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="ch2.html#cb21-1" tabindex="-1"></a><span class="sc">&gt;</span> pi <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb21-2"><a href="ch2.html#cb21-2" tabindex="-1"></a><span class="sc">&gt;</span> pi</span></code></pre></div>
<pre><code>## [1] 2</code></pre>
<p>In general this is a bad idea. The simplest way to fix it is to remove the object we’ve created from <code>R</code>’s workspace with <code>rm()</code>. Then <code>pi</code> reverts back to <code>R</code>’s built in value.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="ch2.html#cb23-1" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">rm</span>(pi)</span>
<span id="cb23-2"><a href="ch2.html#cb23-2" tabindex="-1"></a><span class="sc">&gt;</span> pi</span></code></pre></div>
<pre><code>## [1] 3.141593</code></pre>
<p>Note that <code>R</code> also has <code>T</code> and <code>F</code> built in as aliases for <code>TRUE</code> and <code>FALSE</code>. <code>T</code> and <code>F</code> can be overwritten, but <code>TRUE</code> and <code>FALSE</code> can’t. In general, for example with function arguments, it is better to use <code>argument = TRUE</code> or <code>argument = FALSE</code>, just in case <code>T</code> or <code>F</code> are overwritten with something that could be interpreted as the opposite of what’s wanted, such as issuing <code>T &lt;- 0</code>, since</p>
</div>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="ch2.html#cb25-1" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">as.logical</span>(<span class="dv">0</span>)</span></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
</div>
<div id="flops-floating-point-operations" class="section level3 hasAnchor" number="2.2.6">
<h3><span class="header-section-number">2.2.6</span> Flops: floating point operations<a href="ch2.html#flops-floating-point-operations" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Applying a mathematical operation, such as addition, subtraction, multiplication or division, to two floating point numbers is a <em>floating point operation</em>, or, more commonly, a <em>flop</em><a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>.</p>
<p>The research area <em>numerical analysis</em> includes the analysis of the accuracy of flops, by virtue of numbers being approximately represented. Numerical analysis goes far beyond just analysing flops, and also includes the study of algorithms. Such analysis is far beyond the scope of MTH3045. We will merely cover a couple of examples, which will be illuminating for understanding when flops can go wrong. Such knowledge can help us avoid unnecessary errors.</p>
<p>The addition of floating point numbers works by representing the numbers with a common exponent, and then summing their mantissas.</p>
<div class="example">
<p><span id="exm:unlabeled-div-2" class="example"><strong>Example 2.3  </strong></span>Calculate 123456.7 + 101.7654 using base-10 floating point representations.</p>
<p>We first represent both numbers with a common exponent: that of the largest number. Therefore</p>
<p><span class="math display">\[\begin{align*}
123456.7   &amp;= 1.234567 \times 10^5\\
  101.7654 &amp; = 1.017654 \times 10^2 = 0.001017654 \times 10^5.
\end{align*}\]</span></p>
<p>We next sum their mantissas, i.e.</p>
<p><span class="math display">\[\begin{align*}
123456.7 + 101.7654 &amp;= (1.234567 \times 10^5) + (1.017654 \times 10^2)\\
                    &amp;= (1.234567 \times 10^5) + (0.001017654 \times 10^5)\\
                    &amp;= (1.234567 + 0.001017654) \times 10^5\\
                    &amp;=  1.235584654 \times 10^5
\end{align*}\]</span></p>
<p>Note that if the mantissa was rounded to six decimal places, the result would be <span class="math inline">\(1.235584 \times 10^5\)</span>, and the final three decimal places would effectively be lost. We call the difference between the actual value and that given by the approximate algorithm <strong>roundoff error</strong><a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a>.</p>
</div>
<div class="example">
<p><span id="exm:unlabeled-div-3" class="example"><strong>Example 2.4  </strong></span>Consider the following calculations in <code>R</code>.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="ch2.html#cb27-1" tabindex="-1"></a><span class="sc">&gt;</span> a <span class="ot">&lt;-</span> <span class="fl">1e16</span></span>
<span id="cb27-2"><a href="ch2.html#cb27-2" tabindex="-1"></a><span class="sc">&gt;</span> b <span class="ot">&lt;-</span> <span class="fl">1e16</span> <span class="sc">+</span> pi</span>
<span id="cb27-3"><a href="ch2.html#cb27-3" tabindex="-1"></a><span class="sc">&gt;</span> d <span class="ot">&lt;-</span> b <span class="sc">-</span> a</span></code></pre></div>
<p>Obviously we expect that <span class="math inline">\((1 \times 10^{16} + \pi) - 1 \times 10^{16} = \pi\)</span>.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="ch2.html#cb28-1" tabindex="-1"></a><span class="sc">&gt;</span> d</span></code></pre></div>
<pre><code>## [1] 4</code></pre>
<p>But <code>d =</code> 4! So, what’s happened here?</p>
<p>Double-precision lets us represent the fractional part of a number with 52 bits. In decimal form, this corresponds to roughly 16 decimal places. Addition (or subtraction) with floating point numbers first involves making common the exponent. So above we have <span class="math display">\[ \pi = 3.1415926535897932384626 \times 10^0, \]</span> but when we align its exponent to that of <code>a</code> we get <span class="math display">\[ \pi = 0.0000000000000003 \times 10^{16}. \]</span> Then mantissas are added (or subtracted); hence <span class="math display">\[ \texttt{b} = 1.0000000000000003 \times 10^{16} \]</span> and so <code>d</code><span class="math inline">\(~= 3\)</span>. This simple example demonstrates <strong>cancellation error</strong>. (Note that above we had <code>d =</code> 4, because <code>R</code> did its calculations in base 2, whereas we used base 10.)</p>
</div>
</div>
<div id="some-useful-terminology" class="section level3 hasAnchor" number="2.2.7">
<h3><span class="header-section-number">2.2.7</span> Some useful terminology<a href="ch2.html#some-useful-terminology" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<!-- We call a calculation based on floating point numbers a a **floating point operation** or **flop**. -->
<p>The <strong>machine accuracy</strong>, often written <span class="math inline">\(\epsilon_m\)</span>, and sometimes called <em>machine epsilon</em>, is the smallest (in magnitude) floating point number that, when added to the floating point number 1.0, gives a result different from 1.0. Let’s take a look at this by considering <span class="math inline">\(1 + 10^{-15}\)</span> and <span class="math inline">\(1 + 10^{-16}\)</span>.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="ch2.html#cb30-1" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">format</span>(<span class="fl">1.0</span> <span class="sc">+</span> <span class="fl">1e-15</span>, <span class="at">nsmall =</span> <span class="dv">18</span>)</span></code></pre></div>
<pre><code>## [1] &quot;1.000000000000001110&quot;</code></pre>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="ch2.html#cb32-1" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">format</span>(<span class="fl">1.0</span> <span class="sc">+</span> <span class="fl">1e-16</span>, <span class="at">nsmall =</span> <span class="dv">18</span>)</span></code></pre></div>
<pre><code>## [1] &quot;1.000000000000000000&quot;</code></pre>
<p>The former gives a result different from 1.0, whereas the latter doesn’t. This tells us that <span class="math inline">\(10^{-16} &lt; \epsilon_m &lt; 10^{-15}\)</span>. In fact, <code>R</code> will tell us its machine accuracy, and it’s stored as <code>.Machine$double.eps</code> which is <span class="math inline">\(2.220446\times 10^{-16}\)</span>. Note that <span class="math inline">\(2.220446\times 10^{-16} = 2^{-52}\)</span>, and recall that for double-precision arithmetic we use 52 bits to represent the fractional part. Also note that this is the machine accuracy for double-precision arithmetic, and would be larger for single-precision arithmetic.</p>
<p>By using the floating point representation for a number, we are effectively treating it as rational.
<!-- The difference between a number's true value, and that of its rational approximation, is called **roundoff error**.  -->
We should anticipate that any subsequent flop introduces an additional fractional error of at least <span class="math inline">\(\epsilon_m\)</span>. The accumulation of roundoff errors in one or more flops is <strong>calculation error</strong>.</p>
<!-- ### Numerical analysis -->
<!-- *Numerical analysis* is the study of algorithms that use numerical approximation for the problems of mathematical analysis. When we represent a number in floating-point format, we are typically not interested in the accuracy of approximation that the representation gives for a number itself. Instead, the effect of the approximation on subsequent calculations involving numbers represented as with floating points. Such calculations are typically called *floating-point operations* or *flops*. Put simply, we want flops to give accurate answers. -->
<!-- We won't go into numerical analysis in any kind of detail in MTH3045. However, it is important to be aware of when flops can go wrong, so we'll see a couple of illuminating examples. -->
<!-- \[0 10000000 10010010000111111011011\] -->
<!-- We can represent any real number with a floating point representation.  -->
<!-- 1.2345=\underbrace {12345} _{\text{significand}}\times \underbrace {10} _{\text{base}}\!\!\!\!\!\!^{\overbrace {-4} ^{\text{exponent}}}. -->
<!-- Use something like the following to show floating point representation of a `double` -->
<!-- ```{r} -->
<!-- sprintf("%a", 0.1) -->
<!-- ``` -->
<!-- - <https://stackoverflow.com/questions/50217954/double-precision-64-bit-representation-of-numeric-value-in-r-sign-exponent> -->
<!-- - <https://en.wikipedia.org/wiki/Floating-point_arithmetic> for example with $\pi$ -->
<!-- - @press2007 [\S1.1.1] -->
<!-- ### Roundoff errors -->
<!-- - @press2007 [\S1.1.2] -->
<!-- - Maybe also truncation errors \citet[\S1.1.4]{press2007} -->
<!-- - Perhaps big and little 'O' notation. -->
<p>In statistics, <strong>underflow</strong> can sometimes present problems. Put simply, this is when numbers are sufficiently close to zero that they cannot be differentiated from zero using finite representations, which, for example, results in meaningless reciprocals. Maximum likelihood estimation gives a simple example of when this can occur, because we may repeatedly multiply near-zero numbers together until the likelihood becomes very close to zero. The opposite is <strong>overflow</strong>, when we have numbers too large for the computer to deal with. This is simple to demonstrate as</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="ch2.html#cb34-1" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">log</span>(<span class="fu">exp</span>(<span class="dv">700</span>))</span></code></pre></div>
<pre><code>## [1] 700</code></pre>
<p>works but</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="ch2.html#cb36-1" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">log</span>(<span class="fu">exp</span>(<span class="dv">710</span>))</span></code></pre></div>
<pre><code>## [1] Inf</code></pre>
<p>doesn’t, just because <code>exp(710)</code> is too big. (Here’s a great example where logic, i.e. avoiding taking the logarithm of an exponential, would easily solve the problem.)</p>
<!-- :::{.example name="Underflow and maximum likelihood estimation"} -->
<!-- Consider the modelling the following data as being from the Exp($\theta$) distribution. -->
<!-- ::: -->
<!-- ```{r} -->
<!-- z <- sort(round(runif(10, -.5, .5), 2))#rep(20, 10)#c(20, 30, 40)#rexp(5e2) -->
<!-- dput(z) -->
<!-- z <- c(-0.42, -0.29, -0.19, -0.17, -0.03, 0.04, 0.14, 0.17, 0.4, 0.48) -->
<!-- Lik <- function(theta, x) { -->
<!--   prod(dnorm(x, theta, .2)) -->
<!-- } -->
<!-- logLik <- function(theta, x) { -->
<!--   sum(dnorm(x, theta, .2, log = TRUE)) -->
<!-- } -->
<!-- theta_seq <- seq(-3, 3, by = .01)#0:30#seq(.1, .5, by = .05) -->
<!-- plot(theta_seq, sapply(theta_seq, Lik, x = z), type = 'l',  -->
<!--      ylab = expression(f(bold(y))), xlab = expression(theta)) -->
<!-- matplot(theta_seq, cbind( -->
<!--   log(sapply(theta_seq, Lik, x = z)), -->
<!--   sapply(theta_seq, logLik, x = z)), -->
<!--   type = 'l', lty = 2:3, -->
<!--   ylab = expression(log(f(bold(y)))), xlab = expression(theta)) -->
<!-- ``` -->
<!-- ### Stability -->
<!-- - \citet[\S1.1.3]{press2007} -->
<!-- - \citet[\S1.1.2--1.1.4]{press2007} -->
</div>
</div>
<div id="the-history-of-r" class="section level2 hasAnchor" number="2.3">
<h2><span class="header-section-number">2.3</span> The history of <code>R</code><a href="ch2.html#the-history-of-r" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Before we discuss the history of R, we’ll consider S, which is sometimes considered to be its predecessor. S is a statistical programming language that aimed “to turn ideas into software, quickly and faithfully”, according to John Chambers. Chambers, along with Rick Becker and Allan Wilks, began developing S in 1975 when working for Bell Laboratories, an American industrial research and scientific development company. This was released outside Bell Labs in 1980 as a set of macros, and in 1988 updated to be function based. A commercial implementation of the S programming language, S-PLUS, was also released in 1988, but is no longer available.</p>
<p>Ross Ihaka and Robert Gentleman of the University of Auckland began developing the R programming language in 1992. R is, at its core, an open-source implementation of the S programming language. Its name is partly inspired by that of S, and also by its authors’ first-name initials. R was officially released in 1995, which was followed by a ‘stable beta’ version (v1.0) in 2000. The R Core Team, which develops R, includes Chambers, Ihaka and Gentlemen, and 17 other members. As I write this, the latest version of R is v4.3.2, which is called `Eye Holes’<a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a>. According to a survey by <a href="https://spectrum.ieee.org/the-top-programming-languages-2023">IEEE Spectrum</a>, R is currently the 11th most popular programming language (after 1. Python, 2. Java, 3. C++, 4. C, 5. JavaScript, 6. C#, 7. SQL, 8. Go, 9. TypeScript, 10. HTML). In my opinion, R would not have been as popular as it is if it weren’t free and open-source, and those that develop R could have easily heavily profited financially from it, yet, commendably, their work has instead led to highly regarded and free computer software, which is now frequently and widely used for statistical programming.</p>
</div>
<div id="why-r" class="section level2 hasAnchor" number="2.4">
<h2><span class="header-section-number">2.4</span> Why <code>R</code>?<a href="ch2.html#why-r" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In MTH3045 we will only consider <code>R</code> for any computations. I could give various reasons for this. Instead, I’ll give the following quote:</p>
<blockquote>
“…despite its sometimes frustrating quirks, R is, at its heart, an elegant and beautiful language, well tailored for data science.”
<div align="right">
— <span class="citation">Wickham (2019)</span>
</div>
</blockquote>
<p>I concur with this.</p>
<p>The reason for this is that <code>R</code> tends to be quite good – or better – at most computational aspects of statistics than other programming languages. For example, as a programming language it is relatively accessible and its computational speed is usually okay. A particularly appealing quality of <code>R</code> is that it is free and open-source. The entire code that comprises the software package can be viewed by anyone. This is perhaps why <code>R</code> has such a strong community, which includes package contributions, and helps keep <code>R</code> up-to-date in terms of the statistical models that its users can fit.</p>
<p>However, it is not the only programming language available for statistical computing: Python and MATLAB are other popular choices. Other languages, such as Julia, are growing in popularity. Browsing the internet, you’ll find comparisons of these programming languages. In general the conclusion is that <code>R</code> is slower. However, in MTH3045, it will become apparent that statistical computing is heavily reliant on matrix computations. For these <code>R</code> calls on basic linear algebra subprograms, usually referred to as ‘BLAS’; see <a href="http://www.netlib.org/blas/">http://www.netlib.org/blas/</a> and <a href="https://en.wikipedia.org/wiki/Basic_Linear_Algebra_Subprograms">https://en.wikipedia.org/wiki/Basic_Linear_Algebra_Subprograms</a>. These typically involve incredibly advanced code for matrix algebra, which is often the time-consuming part of statistical computations. If we’re doing computations that heavily rely on BLAS – or can be sensibly manipulated to rely on BLAS - then <code>R</code> becomes an attractive programming language. For these reasons, we use <code>R</code> in MTH3045. Nonetheless, most – if not all – of what we cover in MTH3045 could be achieved in other programming languages.</p>
<div id="basics" class="section level3 hasAnchor" number="2.4.1">
<h3><span class="header-section-number">2.4.1</span> Basics<a href="ch2.html#basics" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>To get started with <code>R</code>, the development team’s ‘An Introduction to R’ manual, available from <a href="https://cran.r-project.org/manuals.html">https://cran.r-project.org/manuals.html</a> is a good starting point. You’ll find the <a href="https://cran.r-project.org/doc/manuals/r-release/R-intro.pdf">pdf version</a> on the MTH3045 VLE page.</p>
<p>I’ll just pick out some key information that will be vital for MTH3045.</p>
<div id="how-r-works" class="section level4 hasAnchor" number="2.4.1.1">
<h4><span class="header-section-number">2.4.1.1</span> How <code>R</code> works<a href="ch2.html#how-r-works" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><code>R</code> is an <em>interpreted</em> programming language. The console in RStudio, the <code>R</code> GUI, or when using <code>R</code> from a terminal, is a command-line interpreter. This is essentially a program that converts what you request into something of the form that can be passed to another programming language. With <code>R</code>, this is to the ‘low-level’ programming languages C or Fortran. Calculations are based on code written in these languages. So, when we issue</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="ch2.html#cb38-1" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fl">1.5</span> <span class="sc">+</span> <span class="fl">2.3</span></span></code></pre></div>
<pre><code>## [1] 3.8</code></pre>
<p><code>R</code> has very cleverly interpreted (for C in this case) that we’ve passed two numeric vectors, each of length one, and that we want to sum them, and that the result should be a vector of length one.</p>
</div>
<div id="how-functions-work" class="section level4 hasAnchor" number="2.4.1.2">
<h4><span class="header-section-number">2.4.1.2</span> How functions work<a href="ch2.html#how-functions-work" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>I’m quite a fan of <code>R</code>‘s help files, but others are not. If you’re ever unsure of how a function works, I suggest first consulting its help file. For example <code>help(lm)</code>, or equivalently <code>?lm</code>, gives help on <code>R</code>’s <code>lm()</code> function. The function is titled ’Fitting Linear Models’. It then has</p>
<ul>
<li><code>Description</code>, describing what the function does;</li>
<li><code>Usage</code>, detailing how we use the function does, i.e. what command(s) to issue;</li>
<li><code>Arguments</code>, explaining what each argument is, and in what format it should be;</li>
<li><code>Details</code>, where present, goes into a bit more detail;</li>
<li><code>Value</code>, states what we’ll get when we call the function; and then</li>
<li><code>Examples</code>, where present, gives examples of usage (which are often incredibly useful).</li>
</ul>
<p>Note that we can also get help on basic arithmetic functions: e.g. <code>help('*')</code> for multiplication and <code>help('%*%')</code> for matrix multiplication.</p>
</div>
</div>
<div id="data-structures" class="section level3 hasAnchor" number="2.4.2">
<h3><span class="header-section-number">2.4.2</span> Data structures<a href="ch2.html#data-structures" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><code>R</code> can handle various different data structures. Here we’ll introduce a few of the more commonly used ones. Familiarity with these will be helpful for various aspects of MTH3045.</p>
<div id="vectors" class="section level4 hasAnchor" number="2.4.2.1">
<h4><span class="header-section-number">2.4.2.1</span> Vectors<a href="ch2.html#vectors" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We’ll ignore scalars, and start with the <code>vector</code>. Issuing</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="ch2.html#cb40-1" tabindex="-1"></a><span class="sc">&gt;</span> vec <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>)</span>
<span id="cb40-2"><a href="ch2.html#cb40-2" tabindex="-1"></a><span class="sc">&gt;</span> vec</span></code></pre></div>
<pre><code>## [1] 1 2 3</code></pre>
<p>creates the <em>column vector</em> <span class="math inline">\((1, 2, 3)^\text{T}\)</span>, where <span class="math inline">\({}^\text{T}\)</span> denotes transpose. We may note that this is equivalent to calling <code>1:3</code>, which is also equivalent to calling <code>seq(1, 3)</code>. <code>seq()</code> is a useful function. It generates <em>regular</em> sequences and its usage is</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="ch2.html#cb42-1" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">1</span>, <span class="at">to =</span> <span class="dv">1</span>, <span class="at">by =</span> ((to <span class="sc">-</span> from)<span class="sc">/</span>(length.out <span class="sc">-</span> <span class="dv">1</span>)), <span class="at">length.out =</span> <span class="cn">NULL</span>)</span></code></pre></div>
<p>Typically we specify <code>from</code> and <code>to</code>, i.e. the start and end points of the sequence, and then specify its length with <code>length.out</code>, or specify its ‘jumps’ with <code>by</code>. Note that when calling a function, we don’t need to give argument names if we give them in the right order, and we can shorten argument names if the shortenings are unique:</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="ch2.html#cb43-1" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.2</span>)</span></code></pre></div>
<pre><code>## [1] 0.0 0.2 0.4 0.6 0.8 1.0</code></pre>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="ch2.html#cb45-1" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">by =</span> <span class="fl">0.2</span>)</span></code></pre></div>
<pre><code>## [1] 0.0 0.2 0.4 0.6 0.8 1.0</code></pre>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="ch2.html#cb47-1" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">b =</span> <span class="fl">0.2</span>)</span></code></pre></div>
<pre><code>## [1] 0.0 0.2 0.4 0.6 0.8 1.0</code></pre>
<p>Another useful function for creating a <code>vector</code> is <code>rep()</code>, which replicates a <code>vector</code>. It can be used to repeat a <code>vector</code> one after the other, such as</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="ch2.html#cb49-1" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">rep</span>(vec, <span class="dv">3</span>)</span></code></pre></div>
<pre><code>## [1] 1 2 3 1 2 3 1 2 3</code></pre>
<p>or to replicate each element of the supplied <code>vector</code> the same number of times</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="ch2.html#cb51-1" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">rep</span>(vec, <span class="at">each =</span> <span class="dv">3</span>)</span></code></pre></div>
<pre><code>## [1] 1 1 1 2 2 2 3 3 3</code></pre>
<p>or a different number of times</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="ch2.html#cb53-1" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">rep</span>(vec, <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">3</span>))</span></code></pre></div>
<pre><code>## [1] 1 1 2 3 3 3</code></pre>
</div>
<div id="matrices" class="section level4 hasAnchor" number="2.4.2.2">
<h4><span class="header-section-number">2.4.2.2</span> Matrices<a href="ch2.html#matrices" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We create a matrix with <code>matrix()</code>. Issuing</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="ch2.html#cb55-1" tabindex="-1"></a><span class="sc">&gt;</span> mat <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>, <span class="dv">2</span>, <span class="dv">3</span>)</span>
<span id="cb55-2"><a href="ch2.html#cb55-2" tabindex="-1"></a><span class="sc">&gt;</span> mat</span></code></pre></div>
<pre><code>##      [,1] [,2] [,3]
## [1,]    1    3    5
## [2,]    2    4    6</code></pre>
<p>specifies a matrix with first row <span class="math inline">\((1, 3, 5)\)</span> and second row <span class="math inline">\((2, 4, 6)\)</span>. The second and third arguments to <code>matrix()</code> are <code>nrow</code> and <code>ncol</code>, its numbers of rows and columns, respectively. Provided the vector that we specify is equal in length to the product of the matrix’s numbers of rows and columns, we only need to supply one of <code>nrow</code> and <code>ncol</code>, as the other can be determined. <code>R</code> will recycle the supplied vector if its length is below the product of <code>nrow</code> and <code>ncol</code>. Note that <code>R</code>, by default, fills matrices column-wise. We can fill row-wise with argument <code>byrow = TRUE</code>:</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="ch2.html#cb57-1" tabindex="-1"></a><span class="sc">&gt;</span> mat2 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>, <span class="at">ncol =</span> <span class="dv">4</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>)</span>
<span id="cb57-2"><a href="ch2.html#cb57-2" tabindex="-1"></a><span class="sc">&gt;</span> mat2</span></code></pre></div>
<pre><code>##      [,1] [,2] [,3] [,4]
## [1,]    1    2    3    4
## [2,]    5    6    7    8</code></pre>
</div>
<div id="arrays" class="section level4 hasAnchor" number="2.4.2.3">
<h4><span class="header-section-number">2.4.2.3</span> Arrays<a href="ch2.html#arrays" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We may think of a <code>vector</code> as a one-column <code>matrix</code>. We can extend this by thinking of a <code>matrix</code> as a two-dimensional <code>array</code>. An <code>array</code> can be of any dimension. Here’s one of dimension <span class="math inline">\(2 \times 3 \times 4\)</span>.</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="ch2.html#cb59-1" tabindex="-1"></a><span class="sc">&gt;</span> arr <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">24</span>, <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>))</span>
<span id="cb59-2"><a href="ch2.html#cb59-2" tabindex="-1"></a><span class="sc">&gt;</span> arr</span></code></pre></div>
<pre><code>## , , 1
## 
##      [,1] [,2] [,3]
## [1,]    1    3    5
## [2,]    2    4    6
## 
## , , 2
## 
##      [,1] [,2] [,3]
## [1,]    7    9   11
## [2,]    8   10   12
## 
## , , 3
## 
##      [,1] [,2] [,3]
## [1,]   13   15   17
## [2,]   14   16   18
## 
## , , 4
## 
##      [,1] [,2] [,3]
## [1,]   19   21   23
## [2,]   20   22   24</code></pre>
<p>In <code>R</code> we refer to each dimension as a <em>margin</em>.</p>
</div>
<div id="lists" class="section level4 hasAnchor" number="2.4.2.4">
<h4><span class="header-section-number">2.4.2.4</span> Lists<a href="ch2.html#lists" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>One of <code>R</code>’s particularly convenient data structures is the <code>list</code>. It is described, by <code>R</code>, as a <em>generic vector</em>: essentially as a vector in which each element can be more complicated than a scalar, which are the elements of a conventional mathematical vector. So a <code>list</code> is a collection of data structures, which might be the same, such as two <code>vector</code>s, or might be different, such as a <code>vector</code> and <code>matrix</code>, or even a <code>vector</code> and another <code>list</code>. For example,</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="ch2.html#cb61-1" tabindex="-1"></a><span class="sc">&gt;</span> lst <span class="ot">&lt;-</span> <span class="fu">list</span>(vec, mat)</span>
<span id="cb61-2"><a href="ch2.html#cb61-2" tabindex="-1"></a><span class="sc">&gt;</span> lst</span></code></pre></div>
<pre><code>## [[1]]
## [1] 1 2 3
## 
## [[2]]
##      [,1] [,2] [,3]
## [1,]    1    3    5
## [2,]    2    4    6</code></pre>
<p><code>list</code>s are therefore incredibly flexible, and hence incredibly useful. A <code>data.frame</code> is actually just a <code>list</code>, albeit one typically comprising <code>vector</code>s of the same length, and hence printable similarly to a <code>matrix</code>.</p>
</div>
<div id="attributes" class="section level4 hasAnchor" number="2.4.2.5">
<h4><span class="header-section-number">2.4.2.5</span> Attributes<a href="ch2.html#attributes" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Sometimes we might have an object that we want to add a bit more information to. We can do this by assigning it <em>attributes</em>. Suppose we’re interested in the number <span class="math inline">\(1 \times 10^{20}\)</span>. We could store this as 20, if we knew we were storing it in <span class="math inline">\(\log_{10}\)</span> format. We could use an attribute to remind us of this.</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="ch2.html#cb63-1" tabindex="-1"></a><span class="sc">&gt;</span> x <span class="ot">&lt;-</span> <span class="dv">20</span></span>
<span id="cb63-2"><a href="ch2.html#cb63-2" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">attr</span>(x, <span class="st">&#39;format&#39;</span>) <span class="ot">&lt;-</span> <span class="st">&#39;log10&#39;</span></span>
<span id="cb63-3"><a href="ch2.html#cb63-3" tabindex="-1"></a><span class="sc">&gt;</span> x</span></code></pre></div>
<pre><code>## [1] 20
## attr(,&quot;format&quot;)
## [1] &quot;log10&quot;</code></pre>
<p>The function <code>attributes()</code> will then show us all the attributes of an object</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="ch2.html#cb65-1" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">attributes</span>(x)</span></code></pre></div>
<pre><code>## $format
## [1] &quot;log10&quot;</code></pre>
<p>and we can use <code>attr()</code> again to access a specific attribute</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="ch2.html#cb67-1" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">attr</span>(x, <span class="st">&#39;format&#39;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;log10&quot;</code></pre>
</div>
</div>
<div id="some-useful-r-functions" class="section level3 hasAnchor" number="2.4.3">
<h3><span class="header-section-number">2.4.3</span> Some useful <code>R</code> functions<a href="ch2.html#some-useful-r-functions" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="sum-rowsums-and-colsums" class="section level4 hasAnchor" number="2.4.3.1">
<h4><span class="header-section-number">2.4.3.1</span> <code>sum()</code>, <code>rowSums()</code> and <code>colSums()</code><a href="ch2.html#sum-rowsums-and-colsums" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>You’ll have encountered various <code>R</code> functions during your degree. For example, <code>sum()</code> gives the <em>global</em> sum of a <code>vector</code>, <code>matrix</code>, or even an <code>array</code>:</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="ch2.html#cb69-1" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">sum</span>(vec)</span></code></pre></div>
<pre><code>## [1] 6</code></pre>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="ch2.html#cb71-1" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">sum</span>(mat)</span></code></pre></div>
<pre><code>## [1] 21</code></pre>
<p>Note that we may want to sum a <code>matrix</code> or <code>array</code> over one or more of its margins. For this we should use <code>rowSums()</code> and <code>colSums()</code>. For a <code>matrix</code>, this is fairly straightforward:</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="ch2.html#cb73-1" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">rowSums</span>(mat)</span></code></pre></div>
<pre><code>## [1]  9 12</code></pre>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="ch2.html#cb75-1" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">colSums</span>(mat)</span></code></pre></div>
<pre><code>## [1]  3  7 11</code></pre>
<p>For an <code>array</code>, though, there are various options. First note that both <code>rowSums()</code> and <code>colSums()</code> have argument <code>dims</code>, which defaults to 1 and so the following implicitly use <code>dims = 1</code>. This means that first margin is regarded as the row, and the remaining margins are regarded as the columns.</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="ch2.html#cb77-1" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">rowSums</span>(arr)</span></code></pre></div>
<pre><code>## [1] 144 156</code></pre>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="ch2.html#cb79-1" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">colSums</span>(arr)</span></code></pre></div>
<pre><code>##      [,1] [,2] [,3] [,4]
## [1,]    3   15   27   39
## [2,]    7   19   31   43
## [3,]   11   23   35   47</code></pre>
<p>If we change <code>dims</code> to <code>dims = 2</code>, the first two margins are now the rows, and the final margin is the column. So <code>rowSums()</code> is over two margins, whereas <code>colSums()</code> is over one:</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="ch2.html#cb81-1" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">rowSums</span>(arr, <span class="at">dims =</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>##      [,1] [,2] [,3]
## [1,]   40   48   56
## [2,]   44   52   60</code></pre>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="ch2.html#cb83-1" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">colSums</span>(arr, <span class="at">dims =</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [1]  21  57  93 129</code></pre>
<p>Note that <code>rowSums()</code> and <code>colSums()</code> require contiguous margins. If we wanted to sum over the first and third margins of the above <code>array</code>, then we can permute its margins with <code>aperm()</code> so that the first and third margins become the first and second margins:</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="ch2.html#cb85-1" tabindex="-1"></a><span class="sc">&gt;</span> arr2 <span class="ot">&lt;-</span> <span class="fu">aperm</span>(arr, <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">2</span>))</span>
<span id="cb85-2"><a href="ch2.html#cb85-2" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">rowSums</span>(arr2)</span></code></pre></div>
<pre><code>## [1] 144 156</code></pre>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="ch2.html#cb87-1" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">colSums</span>(arr2)</span></code></pre></div>
<pre><code>##      [,1] [,2] [,3]
## [1,]    3    7   11
## [2,]   15   19   23
## [3,]   27   31   35
## [4,]   39   43   47</code></pre>
<p>There are also functions <code>rowMeans()</code> and <code>colMeans()</code>, which are self-explanatory.</p>
</div>
<div id="the-apply-family-of-functions" class="section level4 hasAnchor" number="2.4.3.2">
<h4><span class="header-section-number">2.4.3.2</span> The <code>*apply()</code> family of functions<a href="ch2.html#the-apply-family-of-functions" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><code>apply()</code> applies a function to margins of an <code>array</code> or <code>matrix</code>. In the following</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="ch2.html#cb89-1" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">apply</span>(mat, <span class="dv">1</span>, prod)</span></code></pre></div>
<pre><code>## [1] 15 48</code></pre>
<p>we get the product, through function <code>prod()</code>, of each row of <code>mat</code>, and it returns a vector of length the number of rows of <code>mat</code>. The second argument of <code>apply()</code> is the margin over which we want to apply the specified function. Therefore <code>apply(mat, 2, prod)</code> would give product over the columns of <code>mat</code>. We can also apply functions over margins of an <code>array</code>. So</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="ch2.html#cb91-1" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">apply</span>(arr, <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>), max)</span></code></pre></div>
<pre><code>##      [,1] [,2] [,3] [,4]
## [1,]    5   11   17   23
## [2,]    6   12   18   24</code></pre>
<p>uses <code>max()</code> to find the maximum over margin 2. As margins 1 and 3 are of length 2 and 4, respectively, here <code>apply()</code> returns a <span class="math inline">\(2 \times 4\)</span> <code>matrix</code>. Note that <code>apply(..., ..., sum)</code> is inefficient in comparison to <code>rowSums()</code> and <code>colSums()</code>.</p>
<p><code>lapply()</code> applies a function over a <code>list</code>. Consider</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="ch2.html#cb93-1" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">lapply</span>(lst, sum)</span></code></pre></div>
<pre><code>## [[1]]
## [1] 6
## 
## [[2]]
## [1] 21</code></pre>
<p>Note that <code>lapply()</code> returns a <code>list</code> that is the same length as that supplied to it, i.e. that same length as <code>lst</code> here. We might want the result of <code>lapply()</code> simplified and coerced to an array, if possible, which is what <code>sapply()</code> does:</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="ch2.html#cb95-1" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">sapply</span>(lst, sum)</span></code></pre></div>
<pre><code>## [1]  6 21</code></pre>
<p>Sometimes, though, this isn’t possible, and <code>lapply()</code> and <code>sapply()</code> do the same, such as if the applied function returns results of different length, such as</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="ch2.html#cb97-1" tabindex="-1"></a><span class="sc">&gt;</span> lst2 <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="fu">rnorm</span>(<span class="dv">4</span>), <span class="fu">runif</span>(<span class="dv">6</span>))</span>
<span id="cb97-2"><a href="ch2.html#cb97-2" tabindex="-1"></a><span class="sc">&gt;</span> lst2</span></code></pre></div>
<pre><code>## [[1]]
## [1]  0.4013046  0.1944080  0.8592796 -0.9542328
## 
## [[2]]
## [1] 0.4491797 0.7646925 0.3861319 0.3344052 0.9272777 0.3625667</code></pre>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="ch2.html#cb99-1" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">sapply</span>(lst2, sort)</span></code></pre></div>
<pre><code>## [[1]]
## [1] -0.9542328  0.1944080  0.4013046  0.8592796
## 
## [[2]]
## [1] 0.3344052 0.3625667 0.3861319 0.4491797 0.7646925 0.9272777</code></pre>
<p>which still returns a <code>list</code>. Such a <code>list</code> is sometimes called a <em>ragged array</em>.</p>
<p>There are also useful functions <code>tapply()</code> and <code>mapply()</code>, which you may want to explore in your spare time. And if you like them, then take a look a <code>Map()</code> and <code>Reduce()</code>!</p>
</div>
<div id="other-miscellaneous-functions" class="section level4 hasAnchor" number="2.4.3.3">
<h4><span class="header-section-number">2.4.3.3</span> Other miscellaneous functions<a href="ch2.html#other-miscellaneous-functions" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>There are lots of other handy functions in <code>R</code>. For example, I often use <code>split()</code>, <code>match()</code>, <code>combn()</code> and <code>expand.grid()</code>. I won’t try and list <em>all</em> the handy functions here. This sample, however, may give you an idea of the breadth of function that <code>R</code> has to offer. Put simply, if you’re looking for a function in <code>R</code>, there’s a good chance that it’s there. Sometimes, though, the tricky bit is knowing what to search the web for in order find what the function you want is called!</p>
</div>
</div>
<div id="control-structures" class="section level3 hasAnchor" number="2.4.4">
<h3><span class="header-section-number">2.4.4</span> Control structures<a href="ch2.html#control-structures" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>So far we’ve considered executing <em>all</em> of our lines of code. Sometimes, we may want to control how our code is executed according to some logic. We can do this with <em>control structures</em>. For example, <em>conditional execution</em> only runs lines of code if one or more conditions is met, and <em>repeated execution</em> repeatedly runs lines of code until one or more stopping conditions is met.</p>
<!-- #### Repeated execution with `for()` -->
<p>We sometimes refer to a calculation that’s repeated over and over again as a <em>loop</em>. For example,</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="ch2.html#cb101-1" tabindex="-1"></a><span class="sc">&gt;</span> n <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb101-2"><a href="ch2.html#cb101-2" tabindex="-1"></a><span class="sc">&gt;</span> x <span class="ot">&lt;-</span> <span class="fu">integer</span>(n)</span>
<span id="cb101-3"><a href="ch2.html#cb101-3" tabindex="-1"></a><span class="sc">&gt;</span> <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n) {</span>
<span id="cb101-4"><a href="ch2.html#cb101-4" tabindex="-1"></a><span class="sc">+</span>   x[i] <span class="ot">&lt;-</span> i</span>
<span id="cb101-5"><a href="ch2.html#cb101-5" tabindex="-1"></a><span class="sc">+</span> }</span>
<span id="cb101-6"><a href="ch2.html#cb101-6" tabindex="-1"></a><span class="sc">&gt;</span> x</span></code></pre></div>
<pre><code>##  [1]  1  2  3  4  5  6  7  8  9 10</code></pre>
<p>creates an empty integer vector, <code>x</code>, of length <code>n</code>, and then <code>for</code> is a loop that changes the <span class="math inline">\(i\)</span>th value to <span class="math inline">\(i\)</span>, for <span class="math inline">\(i = 1, \ldots, 10\)</span>. (Of course, these first five lines of code are equivalent to <code>x &lt;- 1:10</code>.)</p>
<!-- #### Conditional execution with `if()` -->
<p>Another commonly used control structure is the <code>if()</code> condition, which is often coupled with an <code>else</code> condition. Without an <code>else</code> condition, nothing happens if the <code>if()</code> condition isn’t met. Here’s a simple example using <code>if()</code> and a random draw from the Uniform[0, 1] distribution to mimic a coin toss.</p>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="ch2.html#cb103-1" tabindex="-1"></a><span class="sc">&gt;</span> u <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="dv">1</span>)</span>
<span id="cb103-2"><a href="ch2.html#cb103-2" tabindex="-1"></a><span class="sc">&gt;</span> <span class="cf">if</span> (u <span class="sc">&gt;</span> <span class="fl">0.5</span>) {</span>
<span id="cb103-3"><a href="ch2.html#cb103-3" tabindex="-1"></a><span class="sc">+</span>   x <span class="ot">&lt;-</span> <span class="st">&#39;head&#39;</span></span>
<span id="cb103-4"><a href="ch2.html#cb103-4" tabindex="-1"></a><span class="sc">+</span> } <span class="cf">else</span> {</span>
<span id="cb103-5"><a href="ch2.html#cb103-5" tabindex="-1"></a><span class="sc">+</span>   x <span class="ot">&lt;-</span> <span class="st">&#39;tail&#39;</span></span>
<span id="cb103-6"><a href="ch2.html#cb103-6" tabindex="-1"></a><span class="sc">+</span> }</span>
<span id="cb103-7"><a href="ch2.html#cb103-7" tabindex="-1"></a><span class="sc">&gt;</span> x</span></code></pre></div>
<pre><code>## [1] &quot;tail&quot;</code></pre>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="ch2.html#cb105-1" tabindex="-1"></a><span class="sc">&gt;</span> u</span></code></pre></div>
<pre><code>## [1] 0.03424159</code></pre>
<p>We could then combine the <code>for()</code> and <code>if()</code> control flows to mimic repeated coin tosses. The following gives ten:</p>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="ch2.html#cb107-1" tabindex="-1"></a><span class="sc">&gt;</span> n <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb107-2"><a href="ch2.html#cb107-2" tabindex="-1"></a><span class="sc">&gt;</span> x <span class="ot">&lt;-</span> <span class="fu">character</span>(n)</span>
<span id="cb107-3"><a href="ch2.html#cb107-3" tabindex="-1"></a><span class="sc">&gt;</span> <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>) {</span>
<span id="cb107-4"><a href="ch2.html#cb107-4" tabindex="-1"></a><span class="sc">+</span>   u <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="dv">1</span>)</span>
<span id="cb107-5"><a href="ch2.html#cb107-5" tabindex="-1"></a><span class="sc">+</span>   <span class="cf">if</span> (u <span class="sc">&gt;</span> <span class="fl">0.5</span>) {</span>
<span id="cb107-6"><a href="ch2.html#cb107-6" tabindex="-1"></a><span class="sc">+</span>     x[i] <span class="ot">&lt;-</span> <span class="st">&#39;head&#39;</span></span>
<span id="cb107-7"><a href="ch2.html#cb107-7" tabindex="-1"></a><span class="sc">+</span>   } <span class="cf">else</span> {</span>
<span id="cb107-8"><a href="ch2.html#cb107-8" tabindex="-1"></a><span class="sc">+</span>     x[i] <span class="ot">&lt;-</span> <span class="st">&#39;tail&#39;</span></span>
<span id="cb107-9"><a href="ch2.html#cb107-9" tabindex="-1"></a><span class="sc">+</span>   }</span>
<span id="cb107-10"><a href="ch2.html#cb107-10" tabindex="-1"></a><span class="sc">+</span> }</span>
<span id="cb107-11"><a href="ch2.html#cb107-11" tabindex="-1"></a><span class="sc">&gt;</span> x</span></code></pre></div>
<pre><code>##  [1] &quot;tail&quot; &quot;tail&quot; &quot;tail&quot; &quot;tail&quot; &quot;tail&quot; &quot;head&quot; &quot;tail&quot; &quot;tail&quot; &quot;head&quot; &quot;head&quot;</code></pre>
<p>The function <code>ifelse()</code> can tidy up <code>if ... else ...</code> calls. Equivalently to above we could use <code>ifelse(runif(1) &gt; 0.5, 'head', 'tail')</code>, so that the first argument is the <code>if</code> condition, the second is what’s returned if it’s <code>TRUE</code> and the third is what’s returned if it’s <code>FALSE</code>. Note that <code>for()</code> loops can be a bit untidy, especially if what’s inside the loops is just a line of code. Then <code>replicate()</code> can be useful. Now that we know <code>ifelse()</code>, we could have just used either of the following</p>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="ch2.html#cb109-1" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">replicate</span>(<span class="dv">10</span>, <span class="fu">ifelse</span>(<span class="fu">runif</span>(<span class="dv">1</span>) <span class="sc">&gt;</span> <span class="fl">0.5</span>, <span class="st">&#39;head&#39;</span>, <span class="st">&#39;tail&#39;</span>))</span></code></pre></div>
<pre><code>##  [1] &quot;tail&quot; &quot;tail&quot; &quot;tail&quot; &quot;head&quot; &quot;head&quot; &quot;tail&quot; &quot;head&quot; &quot;head&quot; &quot;head&quot; &quot;tail&quot;</code></pre>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="ch2.html#cb111-1" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">ifelse</span>(<span class="fu">runif</span>(<span class="dv">10</span>) <span class="sc">&gt;</span> <span class="fl">0.5</span>, <span class="st">&#39;head&#39;</span>, <span class="st">&#39;tail&#39;</span>)</span></code></pre></div>
<pre><code>##  [1] &quot;head&quot; &quot;head&quot; &quot;tail&quot; &quot;head&quot; &quot;tail&quot; &quot;head&quot; &quot;head&quot; &quot;tail&quot; &quot;head&quot; &quot;head&quot;</code></pre>
<p>which is equivalent to the above, once the randomness of the call is taken into account.</p>
<p>In the above, we fixed how many coin tosses we wanted, but we might want to stop when we’ve reached a given number of heads (or tails). For such a random stopping condition, we can use the <code>while()</code> control flow. The following stops when we reach four heads.</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="ch2.html#cb113-1" tabindex="-1"></a><span class="sc">&gt;</span> x <span class="ot">&lt;-</span> <span class="fu">character</span>(<span class="dv">0</span>)</span>
<span id="cb113-2"><a href="ch2.html#cb113-2" tabindex="-1"></a><span class="sc">&gt;</span> <span class="cf">while</span>(<span class="fu">sum</span>(x <span class="sc">==</span> <span class="st">&#39;head&#39;</span>) <span class="sc">&lt;</span> <span class="dv">4</span>) {</span>
<span id="cb113-3"><a href="ch2.html#cb113-3" tabindex="-1"></a><span class="sc">+</span>   u <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="dv">1</span>)</span>
<span id="cb113-4"><a href="ch2.html#cb113-4" tabindex="-1"></a><span class="sc">+</span>   <span class="cf">if</span> (u <span class="sc">&gt;</span> <span class="fl">0.5</span>) {</span>
<span id="cb113-5"><a href="ch2.html#cb113-5" tabindex="-1"></a><span class="sc">+</span>     x <span class="ot">&lt;-</span> <span class="fu">c</span>(x, <span class="st">&#39;head&#39;</span>)</span>
<span id="cb113-6"><a href="ch2.html#cb113-6" tabindex="-1"></a><span class="sc">+</span>   } <span class="cf">else</span> {</span>
<span id="cb113-7"><a href="ch2.html#cb113-7" tabindex="-1"></a><span class="sc">+</span>     x <span class="ot">&lt;-</span> <span class="fu">c</span>(x, <span class="st">&#39;tail&#39;</span>)</span>
<span id="cb113-8"><a href="ch2.html#cb113-8" tabindex="-1"></a><span class="sc">+</span>   }</span>
<span id="cb113-9"><a href="ch2.html#cb113-9" tabindex="-1"></a><span class="sc">+</span> }</span>
<span id="cb113-10"><a href="ch2.html#cb113-10" tabindex="-1"></a><span class="sc">&gt;</span> x</span></code></pre></div>
<pre><code>## [1] &quot;tail&quot; &quot;tail&quot; &quot;head&quot; &quot;head&quot; &quot;tail&quot; &quot;tail&quot; &quot;tail&quot; &quot;head&quot; &quot;head&quot;</code></pre>
<p>Note that above <code>x</code> started as a zero-length vector, and grew at each iteration. This is useful if we don’t know how long <code>x</code> needs to be. If we do, it’s better to set the vector’s length at the start.</p>
<p><code>R</code> also has the function <code>repeat()</code> for repeating a set of code. Somewhere this will need a stopping condition that invokes the <code>break</code> command; otherwise the code will be repeated forever!</p>
<!-- ### Object-oriented programming -->
<!-- Probably ignore. -->
</div>
<div id="vectorisation" class="section level3 hasAnchor" number="2.4.5">
<h3><span class="header-section-number">2.4.5</span> Vectorisation<a href="ch2.html#vectorisation" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>A very useful skill to adopt in <code>R</code> early on is to vectorise your code, where possible. Vectorisation typically involves programming with vectors instead of scalars, when such an approach makes sense. Often this means avoiding writing <code>for()</code> loops. Two reasons for this, given in <span class="citation">Wickham (2019)</span>, are:</p>
<blockquote>
<ol style="list-style-type: decimal">
<li><p>It makes problems simpler. Instead of having to think about the components of a vector, you can only think about entire vectors.</p></li>
<li><p>The loops in a vectorised function are written in <code>C</code> instead of <code>R</code>. Loops in <code>C</code> are much faster because they have much less overhead.</p></li>
</ol>
</blockquote>
<p>Here are a few illuminating examples. Later we’ll see what we’ve gained in efficiency.</p>
<p>Suppose we’ve got a <code>vector</code> comprising some <code>NA</code>s (note that we use <code>NA</code> in <code>R</code> when a value is ‘not available’, such as missing data) and we want to swap them all for zeros. The function <code>is.na()</code> tells us which elements in a <code>vector</code> (or <code>matrix</code> or <code>array</code>) are <code>NA</code>.</p>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="ch2.html#cb115-1" tabindex="-1"></a><span class="sc">&gt;</span> x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">2.09</span>, <span class="cn">NA</span>, <span class="sc">-</span><span class="fl">0.25</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="fl">0.52</span>, <span class="cn">NA</span>, <span class="fl">0.48</span>, <span class="fl">0.29</span>, <span class="cn">NA</span>)</span>
<span id="cb115-2"><a href="ch2.html#cb115-2" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">is.na</span>(x)</span></code></pre></div>
<pre><code>##  [1] FALSE  TRUE FALSE  TRUE  TRUE FALSE  TRUE FALSE FALSE  TRUE</code></pre>
<p>We can then subset those elements in a vectorised way and set them to zero.</p>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="ch2.html#cb117-1" tabindex="-1"></a><span class="sc">&gt;</span> x[<span class="fu">is.na</span>(x)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb117-2"><a href="ch2.html#cb117-2" tabindex="-1"></a><span class="sc">&gt;</span> x</span></code></pre></div>
<pre><code>##  [1] -2.09  0.00 -0.25  0.00  0.00  0.52  0.00  0.48  0.29  0.00</code></pre>
<p>We could easily have gone through each element with a <code>for()</code> loop, and swapped each <code>NA</code> element one at a time for a zero, but that would have taken more complicated code, and, for large problems, such as very long vectors, would be slower at performing the operation. The tidiness of vectorisation should reduce the chance of errors in code, too.</p>
<p>Another rather convincing example is if we have a <code>vector</code> and want to know in which interval, from a set of intervals, each of its elements fall.</p>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="ch2.html#cb119-1" tabindex="-1"></a><span class="sc">&gt;</span> n <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb119-2"><a href="ch2.html#cb119-2" tabindex="-1"></a><span class="sc">&gt;</span> x <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="dv">10</span>)</span>
<span id="cb119-3"><a href="ch2.html#cb119-3" tabindex="-1"></a><span class="sc">&gt;</span> x</span></code></pre></div>
<pre><code>##  [1] 0.70195016 0.26158031 0.32150841 0.43997462 0.04981115 0.20305448
##  [7] 0.62779942 0.90433314 0.97744946 0.53480592</code></pre>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="ch2.html#cb121-1" tabindex="-1"></a><span class="sc">&gt;</span> intervals <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">by =</span> <span class="fl">0.1</span>)</span>
<span id="cb121-2"><a href="ch2.html#cb121-2" tabindex="-1"></a><span class="sc">&gt;</span> m <span class="ot">&lt;-</span> <span class="fu">length</span>(intervals) <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb121-3"><a href="ch2.html#cb121-3" tabindex="-1"></a><span class="sc">&gt;</span> which_interval <span class="ot">&lt;-</span> <span class="fu">integer</span>(n)</span>
<span id="cb121-4"><a href="ch2.html#cb121-4" tabindex="-1"></a><span class="sc">&gt;</span> <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n) {</span>
<span id="cb121-5"><a href="ch2.html#cb121-5" tabindex="-1"></a><span class="sc">+</span>   <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>m) {</span>
<span id="cb121-6"><a href="ch2.html#cb121-6" tabindex="-1"></a><span class="sc">+</span>     <span class="cf">if</span> (x[i] <span class="sc">&gt;</span> intervals[j] <span class="sc">&amp;</span> x[i] <span class="sc">&lt;=</span> intervals[j <span class="sc">+</span> <span class="dv">1</span>]) {</span>
<span id="cb121-7"><a href="ch2.html#cb121-7" tabindex="-1"></a><span class="sc">+</span>       which_interval[i] <span class="ot">&lt;-</span> j</span>
<span id="cb121-8"><a href="ch2.html#cb121-8" tabindex="-1"></a><span class="sc">+</span>     }</span>
<span id="cb121-9"><a href="ch2.html#cb121-9" tabindex="-1"></a><span class="sc">+</span>   }</span>
<span id="cb121-10"><a href="ch2.html#cb121-10" tabindex="-1"></a><span class="sc">+</span> }</span>
<span id="cb121-11"><a href="ch2.html#cb121-11" tabindex="-1"></a><span class="sc">&gt;</span> which_interval</span></code></pre></div>
<pre><code>##  [1]  8  3  4  5  1  3  7 10 10  6</code></pre>
<p>As you might imagine, we’re probably not the first person to want to perform such a calculation, and <code>R</code> thinks this too. Hence we can simply use its vectorised <code>findInterval()</code> function to perform the equivalent calculation to that above.</p>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="ch2.html#cb123-1" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">findInterval</span>(x, intervals)</span></code></pre></div>
<pre><code>##  [1]  8  3  4  5  1  3  7 10 10  6</code></pre>
<p>A related function is <code>cut()</code>, which you may want to explore in your own time.</p>
<!-- \texttt{Exercise on `diff()`.} -->
</div>
</div>
<div id="good-practice" class="section level2 hasAnchor" number="2.5">
<h2><span class="header-section-number">2.5</span> Good practice<a href="ch2.html#good-practice" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="useful-tips-to-remember-when-coding" class="section level3 hasAnchor" number="2.5.1">
<h3><span class="header-section-number">2.5.1</span> Useful tips to remember when coding<a href="ch2.html#useful-tips-to-remember-when-coding" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="use-scripts-dont-type-in-the-console" class="section level4 hasAnchor" number="2.5.1.1">
<h4><span class="header-section-number">2.5.1.1</span> Use scripts: don’t type in the Console<a href="ch2.html#use-scripts-dont-type-in-the-console" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>When programming in <code>R</code>, work from scripts or RMarkdown documents.</p>
</div>
<div id="use-functions-for-repeated-calculations" class="section level4 hasAnchor" number="2.5.1.2">
<h4><span class="header-section-number">2.5.1.2</span> Use functions for repeated calculations<a href="ch2.html#use-functions-for-repeated-calculations" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>If you’re using a piece of code more than once, it should probably be formulated as a <code>function</code>.</p>
</div>
<div id="avoid-repeating-lines-of-code" class="section level4 hasAnchor" number="2.5.1.3">
<h4><span class="header-section-number">2.5.1.3</span> Avoid repeating lines of code<a href="ch2.html#avoid-repeating-lines-of-code" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>If you’re copying and pasting code, think about whether this can be avoided.</p>
<p>Here’s an example of ‘the bad’.</p>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="ch2.html#cb125-1" tabindex="-1"></a><span class="sc">&gt;</span> n <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb125-2"><a href="ch2.html#cb125-2" tabindex="-1"></a><span class="sc">&gt;</span> x <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> n, <span class="at">ncol =</span> <span class="dv">4</span>)</span>
<span id="cb125-3"><a href="ch2.html#cb125-3" tabindex="-1"></a><span class="sc">&gt;</span> x[, <span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, <span class="fl">1.0</span>)</span>
<span id="cb125-4"><a href="ch2.html#cb125-4" tabindex="-1"></a><span class="sc">&gt;</span> x[, <span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, <span class="fl">1.5</span>)</span>
<span id="cb125-5"><a href="ch2.html#cb125-5" tabindex="-1"></a><span class="sc">&gt;</span> x[, <span class="dv">3</span>] <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, <span class="fl">2.0</span>)</span>
<span id="cb125-6"><a href="ch2.html#cb125-6" tabindex="-1"></a><span class="sc">&gt;</span> x[, <span class="dv">4</span>] <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, <span class="fl">3.0</span>)</span></code></pre></div>
<p>Here’s an example of something better, given <code>n</code> and <code>x</code> above.</p>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb126-1"><a href="ch2.html#cb126-1" tabindex="-1"></a><span class="sc">&gt;</span> sds <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">1.0</span>, <span class="fl">1.5</span>, <span class="fl">2.0</span>, <span class="fl">3.0</span>)</span>
<span id="cb126-2"><a href="ch2.html#cb126-2" tabindex="-1"></a><span class="sc">&gt;</span> <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>) {</span>
<span id="cb126-3"><a href="ch2.html#cb126-3" tabindex="-1"></a><span class="sc">+</span>   x[, i] <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, sds[i])</span>
<span id="cb126-4"><a href="ch2.html#cb126-4" tabindex="-1"></a><span class="sc">+</span> }</span></code></pre></div>
<p>An improvement would be to swap <code>for (i in 1:4)</code> with <code>for (i in 1:length(sds))</code> or <code>for (i in 1:ncol(x))</code>, as then we’re not relying on remembering the length of <code>sds</code> or equivalently the number of columns of <code>x</code>. Even more tidily, we could use either of the following:</p>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="ch2.html#cb127-1" tabindex="-1"></a><span class="sc">&gt;</span> x1 <span class="ot">&lt;-</span> <span class="fu">sapply</span>(sds, rnorm, <span class="at">n =</span> n, <span class="at">mean =</span> <span class="dv">0</span>)</span>
<span id="cb127-2"><a href="ch2.html#cb127-2" tabindex="-1"></a><span class="sc">&gt;</span> x2 <span class="ot">&lt;-</span> <span class="fu">sapply</span>(sds, <span class="cf">function</span>(z) <span class="fu">rnorm</span>(n, <span class="dv">0</span>, z))</span></code></pre></div>
<p>For <code>x1</code> we’ve relied on knowing the order of the arguments to <code>rnorm()</code>, and by fixing its first and second arguments, <code>n</code> and <code>mean</code>, <code>R</code> knows that the first argument that we’re supplying to <code>sapply()</code> should be <code>sd</code>, its third argument, i.e. <code>rnorm()</code>’s first free argument. This approach relies on good knowledge of a function’s arguments.</p>
</div>
<div id="write-with-style" class="section level4 hasAnchor" number="2.5.1.4">
<h4><span class="header-section-number">2.5.1.4</span> Write with style<a href="ch2.html#write-with-style" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>In <code>R</code> we use the <code>&lt;-</code> symbol to assign an object to a name. The left-hand side of the <code>&lt;-</code> symbol is the name we’re giving the object, and the right-hand side is the code that defines the object. <span class="citation">Wickham (2019, sec. 5.1.2)</span> states: ‘Variable and function names should be lowercase. Use an underscore to separate words within a name.’ Particularly usefully, <span class="citation">Wickham (2019, sec. 5.1.2)</span> also states: ‘Strive for names that are concise and meaningful (this is not easy!)’. It is not easy, but worth aiming towards, especially if you’re re-using an object multiple times.</p>
<p>Spacing is particularly useful for helping the appearance of code. For example, the two lines of code</p>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb128-1"><a href="ch2.html#cb128-1" tabindex="-1"></a><span class="sc">&gt;</span> x1 <span class="ot">&lt;-</span> <span class="fu">sapply</span>(sds, rnorm, <span class="at">n =</span> n, <span class="at">mean =</span> <span class="dv">0</span>)</span>
<span id="cb128-2"><a href="ch2.html#cb128-2" tabindex="-1"></a><span class="sc">&gt;</span> x1<span class="ot">&lt;-</span><span class="fu">sapply</span>(sds,rnorm,<span class="at">n=</span>n,<span class="at">mean=</span><span class="dv">0</span>)</span></code></pre></div>
<p>will both make the same object <code>x1</code>, but, I hope you’ll agree, the first line is easier to read. In general, spacing should be used either side of <code>&lt;-</code>, mathematical operators (e.g. <code>=</code>, <code>+</code>, <code>*</code>, and control flows (e.g. <code>if (...)</code> not <code>if(...)</code>), and after commas. Spacing can also be used to align arguments, such as</p>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="ch2.html#cb129-1" tabindex="-1"></a><span class="sc">&gt;</span> x <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">a =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>,  <span class="dv">4</span>,  <span class="dv">5</span>,  <span class="dv">6</span>),</span>
<span id="cb129-2"><a href="ch2.html#cb129-2" tabindex="-1"></a><span class="sc">+</span>           <span class="at">b =</span> <span class="fu">c</span>(<span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>, <span class="dv">10</span>, <span class="dv">11</span>, <span class="dv">12</span>))</span></code></pre></div>
<p>which can sometimes make code more readable.</p>
</div>
<div id="comment-your-code" class="section level4 hasAnchor" number="2.5.1.5">
<h4><span class="header-section-number">2.5.1.5</span> Comment your code<a href="ch2.html#comment-your-code" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>What a line of code does might be self-explanatory, but might not. When it’s not, add comments to explain what it does. This is particularly useful at the start of a function, when what a function does and its arguments can be stated.</p>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb130-1"><a href="ch2.html#cb130-1" tabindex="-1"></a><span class="sc">&gt;</span> fn <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y, z) {</span>
<span id="cb130-2"><a href="ch2.html#cb130-2" tabindex="-1"></a><span class="sc">+</span> <span class="co"># function to compute (x + y) * z element-wise</span></span>
<span id="cb130-3"><a href="ch2.html#cb130-3" tabindex="-1"></a><span class="sc">+</span> <span class="co"># x, y and z can be compatible scalars, vectors, matrices or arrays</span></span>
<span id="cb130-4"><a href="ch2.html#cb130-4" tabindex="-1"></a><span class="sc">+</span> <span class="co"># returns a scalar, vector, matrix or array</span></span>
<span id="cb130-5"><a href="ch2.html#cb130-5" tabindex="-1"></a><span class="sc">+</span> <span class="co"># (depending on class of x, y and z)</span></span>
<span id="cb130-6"><a href="ch2.html#cb130-6" tabindex="-1"></a><span class="sc">+</span> xplusy <span class="ot">&lt;-</span> x <span class="sc">+</span> y</span>
<span id="cb130-7"><a href="ch2.html#cb130-7" tabindex="-1"></a><span class="sc">+</span> xplusy <span class="sc">*</span> z</span>
<span id="cb130-8"><a href="ch2.html#cb130-8" tabindex="-1"></a><span class="sc">+</span> }</span>
<span id="cb130-9"><a href="ch2.html#cb130-9" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">fn</span>(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>)</span></code></pre></div>
<pre><code>## [1] 20</code></pre>
<div class="remark">
<p><span id="unlabeled-div-4" class="remark"><em>Remark</em>. </span>In the above we could – and should – have just done <code>(x + y) * z</code> on one line, but we’ll find the formulation above useful for later.</p>
</div>
<p>Commenting code is essential if you’re sharing code. You will be sharing code in MTH3045 to submit assignments. Marks will be given for sensible commenting, and may also be given if comments make clear your intentions, even if the code itself contains errors. Commenting is one of those things when coding that can take a bit of discipline. It’s almost always more exciting, for example, to produce a working function as quickly as possible, than to take a bit longer and also comment that function. I tend to think there’s a balance between when to comment and when to code, and might delay commenting until a function is finished. Always comment code, though, while it’s fresh in your mind.</p>
</div>
</div>
<div id="debugging" class="section level3 hasAnchor" number="2.5.2">
<h3><span class="header-section-number">2.5.2</span> Debugging<a href="ch2.html#debugging" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>When we write code in <code>R</code>, we don’t always get it right first time. The errors or, more commonly, <em>bugs</em> in our code may not be straightforward to spot. We call identifying bugs <em>debugging</em>. We want an efficient strategy to identify bugs so that we can fix them.</p>
<p>Let’s assume that our bug lies within a <code>function</code> somewhere. We’ve tried to run the function, and it’s failed. I tend to go through the following sequence of events.</p>
<blockquote>
<ol style="list-style-type: decimal">
<li><p>Read the error message <code>R</code> has returned, if any. From this we may be able to deduce where the bug in our code is.</p></li>
<li><p>If 1. fails, inspect the code and hope to spot the bug (if there’s any hope of spotting it); otherwise</p></li>
<li><p>Use some of <code>R</code>’s functions to help us debug our function.</p></li>
</ol>
</blockquote>
<p>Somewhere within our function, something must not be as we expect. We can inspect what’s inside a function with <code>debug()</code>. I prefer <code>debugonce()</code>, which inspects a function once, as opposed to every time. Suppose we want to debug <code>fn()</code> above. We simply issue</p>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb132-1"><a href="ch2.html#cb132-1" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">debugonce</span>(fn)</span>
<span id="cb132-2"><a href="ch2.html#cb132-2" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">fn</span>(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>)</span></code></pre></div>
<p>in the Console, and then we’ll end up inside the function. So if we type <code>x</code> is the Console, <code>R</code> will print <code>2</code>. It will also be showing the line of code that it’s about to execute, which will be <code>xplusy &lt;- x + y</code>. If we hit <kbd>Enter</kbd> then <code>R</code> will run the line of code. If we then type <code>xplusy</code> in the Console <code>R</code> will print <code>5</code>. Debugging lets us sequentially go through each line of a function. When debugging, <code>R</code> will also throw up an error once we try and execute the line of code where the bug is. This approach to debugging can help us find the offending line of code, and then we may want to debug again up to that line, in order to find what the problem is.</p>
<p>When our <code>function</code> has many lines of code, and we know the bug to be near the end, we may want to choose from which point of the <code>function</code> our debugging starts. We can do this with <code>browser()</code>.</p>
</div>
<div id="profiling-and-benchmarking" class="section level3 hasAnchor" number="2.5.3">
<h3><span class="header-section-number">2.5.3</span> Profiling and benchmarking<a href="ch2.html#profiling-and-benchmarking" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>You may have heard of the term <em>Big Data</em>. Essentially this means lots of data.</p>
<blockquote>
<p>“The definition of big data is data that contains greater variety, arriving in increasing volumes and with more velocity. This is also known as the three Vs.</p>
Put simply, big data is larger, more complex data sets, especially from new data sources.”
<div align="right">
— (<a href="https://www.oracle.com/uk/big-data/what-is-big-data/" class="uri">https://www.oracle.com/uk/big-data/what-is-big-data/</a>)
</div>
</blockquote>
<p>The more data we attempt to fit a statistical model to, the more flops involved, and, in general, the longer it takes to fit and the more memory it needs. Typically we should try and use all the <em>useful</em> data that we can. If data aren’t useful, we shouldn’t use them.</p>
<p>Profiling is the analysis of computer code, typically of its time taken or memory used.</p>
<p>Let’s consider a matrix-based update to <code>fn()</code> above, which we’ll call <code>fn2()</code>, and computes <span class="math inline">\((A + B) C\)</span> for matrices <span class="math inline">\(A\)</span>, <span class="math inline">\(B\)</span> and <span class="math inline">\(C\)</span>.</p>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb133-1"><a href="ch2.html#cb133-1" tabindex="-1"></a><span class="sc">&gt;</span> fn2 <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y, z) {</span>
<span id="cb133-2"><a href="ch2.html#cb133-2" tabindex="-1"></a><span class="sc">+</span> <span class="co"># function to compute (x + y) %*% z</span></span>
<span id="cb133-3"><a href="ch2.html#cb133-3" tabindex="-1"></a><span class="sc">+</span> <span class="co"># x, y and z are matrices with compatible dimensions</span></span>
<span id="cb133-4"><a href="ch2.html#cb133-4" tabindex="-1"></a><span class="sc">+</span> <span class="co"># returns a matrix</span></span>
<span id="cb133-5"><a href="ch2.html#cb133-5" tabindex="-1"></a><span class="sc">+</span> xplusy <span class="ot">&lt;-</span> x <span class="sc">+</span> y</span>
<span id="cb133-6"><a href="ch2.html#cb133-6" tabindex="-1"></a><span class="sc">+</span> xplusy <span class="sc">%*%</span> z</span>
<span id="cb133-7"><a href="ch2.html#cb133-7" tabindex="-1"></a><span class="sc">+</span> }</span>
<span id="cb133-8"><a href="ch2.html#cb133-8" tabindex="-1"></a><span class="sc">&gt;</span> n <span class="ot">&lt;-</span> <span class="fl">5e2</span></span>
<span id="cb133-9"><a href="ch2.html#cb133-9" tabindex="-1"></a><span class="sc">&gt;</span> p <span class="ot">&lt;-</span> <span class="fl">1e4</span></span>
<span id="cb133-10"><a href="ch2.html#cb133-10" tabindex="-1"></a><span class="sc">&gt;</span> A <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">runif</span>(n <span class="sc">*</span> p), n, p)</span>
<span id="cb133-11"><a href="ch2.html#cb133-11" tabindex="-1"></a><span class="sc">&gt;</span> B <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">runif</span>(n <span class="sc">*</span> p), n, p)</span>
<span id="cb133-12"><a href="ch2.html#cb133-12" tabindex="-1"></a><span class="sc">&gt;</span> C <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">runif</span>(n <span class="sc">*</span> p), p, n)</span></code></pre></div>
<p>We can profile with <code>Rprof()</code>. Here we’ll ask it to write what it’s currently doing to file <code>profile.txt</code> every <span class="math inline">\(0.00001\)</span> seconds. Note that <code>Rprof(NULL)</code> ends the profiling.</p>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb134-1"><a href="ch2.html#cb134-1" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">Rprof</span>(<span class="st">&#39;profile.txt&#39;</span>, <span class="at">interval =</span> <span class="fl">1e-5</span>)</span>
<span id="cb134-2"><a href="ch2.html#cb134-2" tabindex="-1"></a><span class="sc">&gt;</span> D <span class="ot">&lt;-</span> <span class="fu">fn2</span>(A, B, C)</span>
<span id="cb134-3"><a href="ch2.html#cb134-3" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">Rprof</span>(<span class="cn">NULL</span>)</span></code></pre></div>
<p>Here’s what’s in <code>profile.txt</code></p>
<pre><code>## sample.interval=10
## &quot;+&quot; &quot;fn2&quot; 
## &quot;%*%&quot; &quot;fn2&quot; 
## &quot;%*%&quot; &quot;fn2&quot; 
## &quot;%*%&quot; &quot;fn2&quot; 
## &quot;%*%&quot; &quot;fn2&quot; 
## &quot;%*%&quot; &quot;fn2&quot; 
## &quot;%*%&quot; &quot;fn2&quot; 
## &quot;%*%&quot; &quot;fn2&quot; 
## &quot;%*%&quot; &quot;fn2&quot; 
## &quot;%*%&quot; &quot;fn2&quot; 
## &quot;%*%&quot; &quot;fn2&quot; 
## &quot;%*%&quot; &quot;fn2&quot; 
## &quot;%*%&quot; &quot;fn2&quot; 
## &quot;%*%&quot; &quot;fn2&quot; 
## &quot;%*%&quot; &quot;fn2&quot; 
## &quot;%*%&quot; &quot;fn2&quot; 
## &quot;%*%&quot; &quot;fn2&quot; 
## &quot;%*%&quot; &quot;fn2&quot;</code></pre>
<p>which is two-column output, as there are at most two functions active. The second column is the first function to be called and then the second is any subsequent functions. From the first column, we see that after 0.00001 seconds <code>R</code> is evaluating function <code>+</code>, i.e. matrix addition; and for the next 17 0.00001-second intervals <code>R</code> is evaluating function <code>%*%</code>, i.e. matrix multiplication. The second column tells us that <code>R</code> is evaluating <code>fn2</code> throughout. For <span class="math inline">\(n \times p\)</span> matrices, matrix addition requires <span class="math inline">\(np\)</span> additions, whereas matrix multiplication requires <span class="math inline">\(p\)</span> multiplications and <span class="math inline">\(p - 1\)</span> additions, each repeated <span class="math inline">\(np\)</span> times. Considering only the dominant terms, we write the computational complexity of matrix multiplication as <span class="math inline">\(O(np^2)\)</span> whereas that of matrix addition is <span class="math inline">\(O(np)\)</span>, which uses so-called ‘big-O’ notation<a href="#fn4" class="footnote-ref" id="fnref4"><sup>4</sup></a>.</p>
<p>Instead of trying to interpret the output of <code>Rprof()</code>, <code>R</code>’s <code>summaryRprof()</code> function will do that for us</p>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb136-1"><a href="ch2.html#cb136-1" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">summaryRprof</span>(<span class="st">&#39;profile.txt&#39;</span>)</span></code></pre></div>
<pre><code>## $by.self
## [1] self.time  self.pct   total.time total.pct 
## &lt;0 rows&gt; (or 0-length row.names)
## 
## $by.total
##       total.time total.pct self.time self.pct
## &quot;fn2&quot;          0    100.00         0     0.00
## &quot;%*%&quot;          0     94.44         0    94.44
## &quot;+&quot;            0      5.56         0     5.56
## 
## $sample.interval
## [1] 1e-05
## 
## $sampling.time
## [1] 0.00018</code></pre>
<p>by working out the percentage of information in the <code>Rprof()</code> output attributable to each unique line of output.</p>
<p>Profiling can be useful for finding <em>bottlenecks</em> in our code, i.e. lines that heavily contribute to the overall computational expense (e.g. time or memory) of the code.</p>
<p>If we find a bottleneck <em>and</em> it’s unbearably slow <em>and</em> we think there’s scope to reduce or eliminate it without disproportionate effort, then we might consider changing our code to make it more efficient. We’ll focus on efficiency in terms of times taken for commands to execute.</p>
<p>Suppose that we’ve put together some code, which we consider to be the <em>benchmark</em> that we want to improve on. Comparison against a benchmark is called <em>benchmarking</em>. One of the simplest ways to benchmark in <code>R</code> is with <code>system.time()</code>, which we saw in the first lecture. Suppose we’ve got the following line in our code, based on matrix <code>A</code> above.</p>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb138-1"><a href="ch2.html#cb138-1" tabindex="-1"></a><span class="sc">&gt;</span> a_sum <span class="ot">&lt;-</span> <span class="fu">apply</span>(A, <span class="dv">1</span>, sum)</span></code></pre></div>
<p>The following tells us how long it takes to execute.</p>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb139-1"><a href="ch2.html#cb139-1" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">system.time</span>(a_sum <span class="ot">&lt;-</span> <span class="fu">apply</span>(A, <span class="dv">1</span>, sum))</span></code></pre></div>
<pre><code>##    user  system elapsed 
##   0.052   0.016   0.068</code></pre>
<p>This gives us three timings. The last, <code>elapsed</code>, tells use how long our code has taken to execute in seconds. Then <code>user</code> and <code>system</code> partition this total time into so-called ‘user time’ and ‘system time’. Their definitions are operating system dependent, but this information from the <code>R</code> help file for <code>proc.time()</code> gives as idea. “The ‘user time’ is the CPU time charged for the execution of user instructions of the calling process. The ‘system time’ is the CPU time charged for execution by the system on behalf of the calling process.” We’ll just consider <code>elapsed</code> time for MTH3045.</p>
<p>For benchmarking in <code>R</code> we’ll consider the <code>microbenchmark::microbenchmark()</code>. Note that this notation refers to function <code>microbenchmark()</code> within the <code>microbenchmark</code> package. If we have the <code>microbenchmark</code> installed, we can either issue <code>microbenchmark::microbenchmark()</code> to use the function or load the package, i.e. <code>library(microbenchmark)</code>, and then just use <code>microbenchmark()</code>. I’ll initially use the <code>::</code> notation to introduce any functions in <code>R</code> that aren’t loaded by default when <code>R</code> starts.</p>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb141-1"><a href="ch2.html#cb141-1" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">library</span>(microbenchmark)</span>
<span id="cb141-2"><a href="ch2.html#cb141-2" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">microbenchmark</span>(</span>
<span id="cb141-3"><a href="ch2.html#cb141-3" tabindex="-1"></a><span class="sc">+</span>   <span class="fu">apply</span>(A, <span class="dv">1</span>, sum),</span>
<span id="cb141-4"><a href="ch2.html#cb141-4" tabindex="-1"></a><span class="sc">+</span>   <span class="fu">rowSums</span>(A)</span>
<span id="cb141-5"><a href="ch2.html#cb141-5" tabindex="-1"></a><span class="sc">+</span> )</span></code></pre></div>
<pre><code>## Unit: milliseconds
##              expr       min        lq      mean   median        uq        max
##  apply(A, 1, sum) 65.953924 72.511004 73.520382 72.74371 73.000530 111.846920
##        rowSums(A)  6.706583  6.845764  6.931324  6.90962  6.969004   9.415263
##  neval cld
##    100   b
##    100  a</code></pre>
<p>The <code>microbenchmark::microbenchmark()</code> function is particularly handy because it automatically chooses its units, which here is milliseconds. For functions that take longer to execute it might, for example, choose seconds. The output of <code>microbenchmark::microbenchmark()</code> includes <code>neval</code>, the number of evaluations it’s used for each function; from these, the range and quartiles are calculated. If we compare medians, we note that the <code>rowSums()</code> approach is about an order magnitude faster than the <code>apply()</code> approach. We should note that for either approach, timings differ between evaluations, even though they’re doing the same calculation and giving the same answer. On this occasion the minimum and maximum times are between two and three factors different.</p>
<p>Note that we could also use <code>benchmark::rbenchmark()</code> for benchmarking, which gives similar details to <code>system.time()</code>. For MTH3045, I’ll use <code>microbenchmark::microbenchmark()</code>, because I find its output more useful.</p>
</div>
</div>
<div id="compiled-code-with-rcpp" class="section level2 hasAnchor" number="2.6">
<h2><span class="header-section-number">2.6</span> Compiled code with <code>Rcpp</code><a href="ch2.html#compiled-code-with-rcpp" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We’ve seen that vectorised functions can simplify our code (and later we’ll see that they can bring considerable gains in computation time). Suppose, though, that we want a vectorised function, but that it doesn’t exist for our purposes. We could write a function in <code>C</code> or <code>FORTRAN</code>. However, using <code>Rcpp</code> is much more convenient. <code>Rcpp</code> is an <code>R</code> package that efficiently and tidily links <code>R</code> and <code>C++</code>.</p>
<p>Let’s consider a simple example of a function to calculate the sum of a vector.</p>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb143-1"><a href="ch2.html#cb143-1" tabindex="-1"></a><span class="sc">&gt;</span> sum_R <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb143-2"><a href="ch2.html#cb143-2" tabindex="-1"></a><span class="sc">+</span> <span class="co"># function to calculate sum of a vector</span></span>
<span id="cb143-3"><a href="ch2.html#cb143-3" tabindex="-1"></a><span class="sc">+</span> <span class="co"># x is a vector</span></span>
<span id="cb143-4"><a href="ch2.html#cb143-4" tabindex="-1"></a><span class="sc">+</span> <span class="co"># returns a scalar</span></span>
<span id="cb143-5"><a href="ch2.html#cb143-5" tabindex="-1"></a><span class="sc">+</span> out <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb143-6"><a href="ch2.html#cb143-6" tabindex="-1"></a><span class="sc">+</span> <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(x))</span>
<span id="cb143-7"><a href="ch2.html#cb143-7" tabindex="-1"></a><span class="sc">+</span>   out <span class="ot">&lt;-</span> out <span class="sc">+</span> x[i]</span>
<span id="cb143-8"><a href="ch2.html#cb143-8" tabindex="-1"></a><span class="sc">+</span> out</span>
<span id="cb143-9"><a href="ch2.html#cb143-9" tabindex="-1"></a><span class="sc">+</span> }</span></code></pre></div>
<p>Obviously, we should use <code>sum()</code>, but if it wasn’t available to us, then the above would be an alternative.</p>
<p>Consider the following <code>C++</code> function, which I’ve got stored as <code>sum_Rcpp.cpp</code>, so that the contents of the .cpp file are as below.</p>
<div class="sourceCode" id="cb144"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb144-1"><a href="ch2.html#cb144-1" tabindex="-1"></a><span class="op">&gt;</span> <span class="er">#include &lt;RcppArmadillo.h&gt;</span></span>
<span id="cb144-2"><a href="ch2.html#cb144-2" tabindex="-1"></a><span class="op">+</span> <span class="co">// [[Rcpp::depends(RcppArmadillo)]]</span></span>
<span id="cb144-3"><a href="ch2.html#cb144-3" tabindex="-1"></a><span class="op">+</span> </span>
<span id="cb144-4"><a href="ch2.html#cb144-4" tabindex="-1"></a><span class="op">+</span> <span class="co">// [[Rcpp::export]]</span></span>
<span id="cb144-5"><a href="ch2.html#cb144-5" tabindex="-1"></a><span class="op">+</span> <span class="dt">double</span> sum_Rcpp<span class="op">(</span>arma<span class="op">::</span>vec x<span class="op">)</span> <span class="op">{</span></span>
<span id="cb144-6"><a href="ch2.html#cb144-6" tabindex="-1"></a><span class="op">+</span> <span class="dt">double</span> out <span class="op">=</span> <span class="fl">0.0</span><span class="op">;</span></span>
<span id="cb144-7"><a href="ch2.html#cb144-7" tabindex="-1"></a><span class="op">+</span> <span class="dt">int</span> n <span class="op">=</span> x<span class="op">.</span>size<span class="op">();</span></span>
<span id="cb144-8"><a href="ch2.html#cb144-8" tabindex="-1"></a><span class="op">+</span> <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i<span class="op">++;</span> i <span class="op">&lt;</span> n<span class="op">)</span> <span class="op">{</span></span>
<span id="cb144-9"><a href="ch2.html#cb144-9" tabindex="-1"></a><span class="op">+</span>   out <span class="op">+=</span> x<span class="op">[</span>i<span class="op">];</span></span>
<span id="cb144-10"><a href="ch2.html#cb144-10" tabindex="-1"></a><span class="op">+</span> <span class="op">}</span></span>
<span id="cb144-11"><a href="ch2.html#cb144-11" tabindex="-1"></a><span class="op">+</span> <span class="cf">return</span> out<span class="op">;</span></span>
<span id="cb144-12"><a href="ch2.html#cb144-12" tabindex="-1"></a><span class="op">+</span> <span class="op">}</span></span></code></pre></div>
<p>We won’t go into great detail on <code>Rcpp</code> in MTH3045. The purpose of this section is to raise awareness of its existence, should you ever need it. In the above <code>.cpp</code> file:</p>
<ul>
<li><code>#include &lt;RcppArmadillo.h&gt;</code> and <code>\\ [[Rcpp::depends(RcppArmadillo)]]</code> point to the <code>RcppArmadillo</code> library;</li>
<li><code>// [[Rcpp::export]]</code> makes a function that is visible to <code>R</code>;</li>
<li><code>double sum_Rcpp(arma::vec x) {</code> specifies that our function returns a <code>double</code>, i.e. a single value of double-precision, is called <code>sum_Rcpp</code>, and that its one argument is a vector, hence <code>arma::vec</code>, which we’re calling <code>x</code>;</li>
<li><code>double out = 0.0;</code> forms the double that will be returned, and sets its initial value to 0.0;</li>
<li><code>int n = x.size();</code> finds the length of <code>x</code> and stores it as an integer called <code>n</code>;</li>
<li><code>for (int i = 0; i++; i &lt; n) {</code> initiates a loop: we’ve called our index <code>i</code> and specified that it’s an integer; then we’ve specified that it goes up by one each time with <code>i++</code>, and stops at <code>n - 1</code> with <code>i &lt; n</code>. (Note here that indices in C++ start at zero, whereas they start at one in <code>R</code>.)</li>
<li>We then update <code>out</code> at each iteration by adding <code>x[i]</code>. (Note that <code>out += ...</code> is equivalent to <code>out = out + ...</code> .)</li>
<li>We then close the loop, and specify what we return.</li>
</ul>
<p>An important difference between <code>R</code> and C++ code is that for the latter we’re specifying what’s an integer and what’s a double. Then <code>Rcpp::sourceCpp()</code> checks that what we’ve specified is okay. By not specifying these normally in <code>R</code>, time is needed to interpret the code. We avoid these overheads with C++ code. The trade-off is that C++ code usually takes a bit longer to write, because we need to think about the form of our data, whereas <code>R</code> can handle most of this for us.</p>
<p>To use the <code>cpp</code> function in <code>R</code>, we compile it with <code>Rcpp::sourceCpp()</code>. We’re also going to load <code>RcppArmadillo</code>, which gives access to the excellent <code>Armadillo</code> C++ library for linear algebra and scientific computing, more details of which can be found at <a href="http://arma.sourceforge.net/docs.html">http://arma.sourceforge.net/docs.html</a>.</p>
<p>We can then perform a quick benchmark on what we’ve done.</p>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb145-1"><a href="ch2.html#cb145-1" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">library</span>(RcppArmadillo)</span>
<span id="cb145-2"><a href="ch2.html#cb145-2" tabindex="-1"></a><span class="sc">&gt;</span> Rcpp<span class="sc">::</span><span class="fu">sourceCpp</span>(<span class="st">&#39;sum_Rcpp.cpp&#39;</span>)</span>
<span id="cb145-3"><a href="ch2.html#cb145-3" tabindex="-1"></a><span class="sc">&gt;</span> x <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="fl">1e3</span>)</span>
<span id="cb145-4"><a href="ch2.html#cb145-4" tabindex="-1"></a><span class="sc">&gt;</span> microbenchmark<span class="sc">::</span><span class="fu">microbenchmark</span>(</span>
<span id="cb145-5"><a href="ch2.html#cb145-5" tabindex="-1"></a><span class="sc">+</span>   <span class="fu">sum_R</span>(x),</span>
<span id="cb145-6"><a href="ch2.html#cb145-6" tabindex="-1"></a><span class="sc">+</span>   <span class="fu">sum_Rcpp</span>(x),</span>
<span id="cb145-7"><a href="ch2.html#cb145-7" tabindex="-1"></a><span class="sc">+</span>   <span class="fu">sum</span>(x)</span>
<span id="cb145-8"><a href="ch2.html#cb145-8" tabindex="-1"></a><span class="sc">+</span> )</span></code></pre></div>
<pre><code>## Unit: nanoseconds
##         expr   min      lq     mean  median      uq     max neval cld
##     sum_R(x) 23957 24994.5 44832.81 25730.0 26227.0 1921380   100   b
##  sum_Rcpp(x)  1450  1594.0  7624.77  1666.5  1754.0  579110   100  ab
##       sum(x)   792   835.5   897.53   863.0   897.5    2266   100  a</code></pre>
<p>We see that <code>sum_Rcpp()</code> is typically at least an order of magnitude faster than <code>sum_R()</code>. However, it’s still slower than <code>sum()</code>, because it’s one of <code>R</code>’s functions that’s heavily optimised for efficiency. It’s great that we have such efficiency at our disposal.</p>
</div>
<div id="bibliographic-notes" class="section level2 hasAnchor" number="2.7">
<h2><span class="header-section-number">2.7</span> Bibliographic notes<a href="ch2.html#bibliographic-notes" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>For further details on topics covered in this chapter, consider the following.</p>
<ul>
<li><p>Positional number systems: <span class="citation">Press et al. (2007, sec. 1.1.1)</span> and <span class="citation">Monahan (2011, sec. 2.2)</span>.</p></li>
<li><p>Fundamentals of programming in <code>R</code>: <span class="citation">W. N. Venables and R Core Team (2021)</span>, <span class="citation">Wickham (2019, Ch. 2)</span> and <span class="citation">Grolemund (2014, Ch. 1-5)</span>.</p></li>
<li><p>Profiling and benchmarking: <span class="citation">Wickham (2019, Ch. 22-24)</span> and almost all of <span class="citation">Gillespie and Lovelace (2016)</span>, especially Section 1.6.</p></li>
<li><p><code>R</code> coding style: Various parts of <span class="citation">Wickham (2019)</span> and <span class="citation">Gillespie and Lovelace (2016)</span>.</p></li>
</ul>
<!-- ## Exercises -->
<!-- ```{r child = 'ch2ex_child.Rmd'} -->
<!-- ``` -->
</div>
</div>
<div class="footnotes">
<hr />
<ol start="1">
<li id="fn1"><p>Note that in MTH3045 we’ll use <em>flops</em> as the plural of flop. It is also often used to abbreviate floating point operations per second, but for that we’ll use flop/s. For reference, ENIAC, the first (nonsuper)-computer, processed about 500 flop/s in 1946. My desktop computer can apparently complete 11,692,000,000 flop/s. The current record, set by American supercomputer Frontier in May2022, is 1.102 exaflop/s, i.e. 1,102,000,000,000,000,000 flop/s!<a href="ch2.html#fnref1" class="footnote-back">↩︎</a></p></li>
<li id="fn2"><p>A rather catastrophic example of roundoff error is that of the Ariane rocket launched on June 4, 1996 by the European Space Agency. Ultimately, it caused the rocket to be destoryed on its 37th flight, which the interested reader can read more about <a href="https://www.bbc.com/future/article/20150505-the-numbers-that-lead-to-disaster">here</a> and on various other parts of the web. The Patriot missile is another well-known example.<a href="ch2.html#fnref2" class="footnote-back">↩︎</a></p></li>
<li id="fn3"><p>I’d always wondered where the names for different R versions come from. Then, when putting these lecture notes together, I decided to find out, and came across Lucy D’Agostino McGowan’s blog entry <a href="https://livefreeordichotomize.com/2017/09/28/r-release-names/">R release names</a>. Anyway, the answer is that they’re inspired by Peanuts comic strips, films and badges.<a href="ch2.html#fnref3" class="footnote-back">↩︎</a></p></li>
<li id="fn4"><p>big-O notation – Consider functions <span class="math inline">\(f()\)</span> and <span class="math inline">\(g()\)</span>. We write <span class="math inline">\(f(x) = O(g(x))\)</span> if and only if there exist constants <span class="math inline">\(N\)</span> and <span class="math inline">\(C\)</span> such that <span class="math inline">\(|f(x)| \leq C |g(x)|~\forall~x&gt;N\)</span>. Put simply, this means that <span class="math inline">\(f()\)</span> does not grow faster than <span class="math inline">\(g()\)</span>.<a href="ch2.html#fnref4" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="matrix-based-computing.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
